# 12 成果物パッケージング（AIPMハッカソン）

## 目的
最終成果物（HTML/CSS/JS）とドキュメント（README、実装メモ、チェック結果等）をStock側のプロジェクト配下に集約（コピー）します。初期化時に作成した Program/Project 配下に、提出フォルダを生成し、Flow の作業成果をそのままパッケージングします。

## 実行手順
```yaml
- trigger: "(提出_成果物パッケージング|PackageArtifacts)"
  priority: high
  steps:
    - name: "infer_defaults_from_thread"
      action: "analyze"
      data: ["{{thread_messages}}","{{read_files(find_files(patterns=['Flow/**/hackathon/**/README.md','Flow/**/hackathon/**/slides_*.md','Flow/**/hackathon/**/check_*.md']))}}"]
      instructions: |
        Program/Project/flow_dir/submit_folder/提出メモ/目的/背景 の初期値候補を抽出し、display用に箇条書きで提示してください。
      store_as: "auto_submit_seed"
    - name: "prefill_submit_seed"
      action: "display"
      content: |
        🔎 自動抽出
        {{auto_submit_seed}}
    - name: "ask_submission_meta"
      action: "ask_questions_with_template"
      template: |
        === 提出メタ情報 ===
        1. Program（既定: AIPM_Hackathon）
        →
        2. Project（アプリ名。例: SmartTodo-Mama）
        →
        3. Flowの作業ディレクトリ名（既定: hackathon_new）
        →
        4. 提出フォルダ名（既定: submit_{{today}}）
        →
        5. READMEに記載する「提出メモ」（任意）
        →
        6. 目的（現時点の仮説。既定は初期化時の内容で可）
        →
        7. 背景（既定は初期化時の内容で可）
        →
        =====================================
    
    - name: "wait_meta"
      action: "wait_for_all_answers"
    
    - name: "confirm_packaging"
      action: "confirm"
      message: "Flow/{{today}}/{{flow_dir}} の中身を Stock/programs/{{program_id}}/projects/{{project_id}}/submissions/{{submit_folder}} へコピーします。よろしいですか？"
    
    - name: "show_parallel_shells"
      action: "display"
      content: |
        💻 実行環境メモ（Windows対応・手動時の参考）

        Bash (macOS/Linux):
        ```bash
        mkdir -p "Stock/programs/{{program_id}}/projects/{{project_id}}/submissions/{{submit_folder}}"
        cp -R "Flow/{{today}}/{{flow_dir}}"/* "Stock/programs/{{program_id}}/projects/{{project_id}}/submissions/{{submit_folder}}/"
        ```

        PowerShell (Windows/macOSのpwsh):
        ```powershell
        $dst = "Stock/programs/{{program_id}}/projects/{{project_id}}/submissions/{{submit_folder}}"
        New-Item -ItemType Directory -Path $dst -Force | Out-Null
        Copy-Item -Path "Flow/{{today}}/{{flow_dir}}/*" -Destination $dst -Recurse -Force
        ```

    # 1) 提出先フォルダ生成
    - name: "create_submission_dir"
      action: "execute_shell"
      command: |
        mkdir -p "Stock/programs/{{program_id}}/projects/{{project_id}}/submissions/{{submit_folder}}"
    
    # 2) Flow → Stock へ成果物をコピー（フォルダごと）
    - name: "copy_flow_to_stock"
      action: "execute_shell"
      command: |
        cp -R "Flow/{{today}}/{{flow_dir}}"/* "Stock/programs/{{program_id}}/projects/{{project_id}}/submissions/{{submit_folder}}/"
    
    # 3) 提出用README（Stock側）を生成（既存READMEは残し、提出用README_submission.mdを作る）
    - name: "write_submission_readme"
      action: "create_markdown_file"
      path: "Stock/programs/{{program_id}}/projects/{{project_id}}/submissions/{{submit_folder}}/README_submission.md"
      content: |
        # 提出パッケージ README
        
        - Program: {{program_id}}
        - Project: {{project_id}}
        - 提出フォルダ: submissions/{{submit_folder}}
        - 作成日: {{today}}
        
        ## 概要
        本フォルダは Flow の作業成果をそのまま集約した提出パッケージです。
        
        ## 目的（現時点の仮説）
        {{purpose}}
        
        ## 背景
        {{background}}
        
        ## 提出メモ
        {{submission_note}}
        
        ## 参考（想定主要ファイル）
        - index.html / styles.css / app.js
        - persona_todo.md / problem_*.md / solution_map*.md / story_map*.md / ui_*.md
        - dev_tasks.yaml / dev_tasks_order*.md / dev_runbook.md
        - check_*.md / work_*.md
        - experience_map.yaml / problem_map.yaml / solution_map.yaml / story_map.yaml
        - screen_map.yaml / screen_flow.yaml
        
        実体は下記マニフェストを参照してください。
    
    # 4) マニフェスト雛形を生成（実体列挙は必要に応じて追記）
    - name: "write_manifest"
      action: "create_markdown_file"
      path: "Stock/programs/{{program_id}}/projects/{{project_id}}/submissions/{{submit_folder}}/MANIFEST.md"
      content: |
        # MANIFEST（{{today}}）
        
        ここに本パッケージに含まれる主要ファイル/ディレクトリを列挙してください。
        - 例: index.html
        - 例: styles.css
        - 例: app.js
        - 例: persona_todo.md
        - 例: Flow成果の各種YAML/MD
    
    - name: "notify_done"
      action: "display"
      content: |
        ✅ 提出パッケージを作成しました。
        - Stock/programs/{{program_id}}/projects/{{project_id}}/submissions/{{submit_folder}}/
        次は `@13_GitHub提出` を実行してGitHubへ提出してください。
```

## 次のコマンド
→ `提出_GitHub提出` で運営リポジトリへ提出

