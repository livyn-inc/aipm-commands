---
name: QAå®Ÿè¡Œï¼ˆå“è³ªä¿è¨¼ãƒ»ãƒ†ã‚¹ãƒˆå®Ÿè¡Œï¼‰
---

# 11 : QAå®Ÿè¡Œï¼ˆAIPMãƒãƒƒã‚«ã‚½ãƒ³ï¼‰- æ®µéšçš„å“è³ªä¿è¨¼ãƒ—ãƒ­ã‚»ã‚¹

## å‰æ
- ç›´å‰ã« `07_é–‹ç™ºã‚¿ã‚¹ã‚¯åˆ†è§£` ãŒå®Œäº†æ¸ˆã¿ï¼ˆdev_tasks.yaml, total_development_spec.md ãŒå­˜åœ¨ï¼‰
- å„é–‹ç™ºã‚¿ã‚¹ã‚¯ã®å—ã‘å…¥ã‚Œãƒ†ã‚¹ãƒˆã¯å®Œäº†æ¸ˆã¿
- **total_development_spec.md ã®ãƒ†ã‚¹ãƒˆæˆ¦ç•¥ã‚’ãƒ™ãƒ¼ã‚¹**ã«ã€åŒ…æ‹¬çš„ãªQAã‚’å®Ÿæ–½
- **HITLï¼ˆHuman-In-The-Loopï¼‰ã‚’æ„è­˜**ã—ãŸæ®µéšçš„å®Ÿè¡Œ
- pytestï¼ˆãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼‰ã€chrome-mcpï¼ˆçµ±åˆãƒ†ã‚¹ãƒˆï¼‰ã‚’æ´»ç”¨

## ç›®çš„
- äººé–“ã®QAæ‹…å½“è€…ã¨åŒã˜ã‚ˆã†ãªå¤šè§’çš„ãªå“è³ªä¿è¨¼ã‚’å®Ÿç¾
- ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ â†’ çµ±åˆãƒ†ã‚¹ãƒˆ â†’ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ â†’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆã®æ®µéšçš„å®Ÿè¡Œ
- åŠ¹ç‡çš„ã‹ã¤ç¶²ç¾…çš„ãªãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸
- ãƒ†ã‚¹ãƒˆçµæœã®å¯è¦–åŒ–ã¨ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ

## å®Ÿè¡Œæ‰‹é †
```yaml
- trigger: "(QAå®Ÿè¡Œ|QAé–‹å§‹|å“è³ªä¿è¨¼|Quality Assurance|ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ)"
  priority: high
  steps:
    # ========================================
    # Phase 0: åˆæœŸåŒ–ãƒ»æº–å‚™
    # ========================================
    - name: "load_test_strategy"
      action: "analyze"
      data: [
        "{{read_files(find_files(patterns=['**/total_development_spec.md']))}}",
        "{{read_files(find_files(patterns=['**/dev_tasks.yaml']))}}",
        "{{read_files(find_files(patterns=['**/dev_tasks_order.md']))}}",
        "{{read_files(find_files(patterns=['**/user_story_map.yaml']))}}"
      ]
      instructions: |
        total_development_spec.md ã®ãƒ†ã‚¹ãƒˆæˆ¦ç•¥ã‚’è§£æã—ã€ä»¥ä¸‹ã‚’æŠ½å‡ºï¼š
        1. ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆè¦ä»¶ï¼ˆpytestã‚«ãƒãƒ¬ãƒƒã‚¸ç›®æ¨™ã€é‡è¦é–¢æ•°ãƒªã‚¹ãƒˆï¼‰
        2. çµ±åˆãƒ†ã‚¹ãƒˆè¦ä»¶ï¼ˆã‚·ãƒŠãƒªã‚ªã€ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼‰
        3. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆè¦ä»¶ï¼ˆè¦æ¨¡ã€æ¸¬å®šé …ç›®ï¼‰
        4. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ä»¶ï¼ˆèªè¨¼ã€APIä¿è­·ï¼‰
        
        dev_tasks.yaml ã‹ã‚‰å…¨ã‚¿ã‚¹ã‚¯ã®æˆæœç‰©ãƒ•ã‚¡ã‚¤ãƒ«ã¨ãƒ†ã‚¹ãƒˆè¦³ç‚¹ã‚’æŠ½å‡ºã€‚
        åŠ¹ç‡çš„ãªãƒ†ã‚¹ãƒˆé †åºã‚’ææ¡ˆï¼ˆä¾å­˜é–¢ä¿‚è€ƒæ…®ï¼‰ã€‚
      store_as: "test_strategy"
    
    - name: "create_qa_structure"
      action: "execute_shell"
      command: |
        mkdir -p "Flow/{{today}}/{{flow_dir}}/11_QAå®Ÿè¡Œ/unit_tests" && \
        mkdir -p "Flow/{{today}}/{{flow_dir}}/11_QAå®Ÿè¡Œ/integration_tests" && \
        mkdir -p "Flow/{{today}}/{{flow_dir}}/11_QAå®Ÿè¡Œ/performance_tests" && \
        mkdir -p "Flow/{{today}}/{{flow_dir}}/11_QAå®Ÿè¡Œ/test_reports" && \
        mkdir -p "Flow/{{today}}/{{flow_dir}}/11_QAå®Ÿè¡Œ/test_data"
      message: "QAå®Ÿè¡Œç”¨ãƒ•ã‚©ãƒ«ãƒ€æ§‹é€ ã‚’ä½œæˆã—ã¾ã—ãŸ"
    
    - name: "display_test_overview"
      action: "display"
      content: |
        ğŸ“Š QAå®Ÿè¡Œè¨ˆç”»æ¦‚è¦
        â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
        
        **ãƒ†ã‚¹ãƒˆæˆ¦ç•¥ã‚µãƒãƒªãƒ¼**:
        {{test_strategy.summary}}
        
        **å¯¾è±¡ã‚¿ã‚¹ã‚¯**: {{test_strategy.total_tasks}}ä»¶
        **ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆå¯¾è±¡é–¢æ•°**: {{test_strategy.unit_test_targets}}ä»¶
        **çµ±åˆãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª**: {{test_strategy.integration_scenarios}}ä»¶
        **æ¨å®šå®Ÿè¡Œæ™‚é–“**: {{test_strategy.estimated_time}}
        
        **æ®µéšçš„å®Ÿè¡Œãƒ—ãƒ©ãƒ³**:
        1. Phase 1: ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼ˆpytestï¼‰- åŸºç›¤é–¢æ•°ã‹ã‚‰é †æ¬¡
        2. Phase 2: çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆchrome-mcpï¼‰- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚·ãƒŠãƒªã‚ªãƒ™ãƒ¼ã‚¹
        3. Phase 3: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ - å¤§è¦æ¨¡ãƒ‡ãƒ¼ã‚¿ã§ã®å‹•ä½œç¢ºèª
        4. Phase 4: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆ - èªè¨¼ãƒ»APIä¿è­·ç¢ºèª
        
        å„Phaseå®Œäº†æ™‚ã«äººé–“ç¢ºèªãƒã‚¤ãƒ³ãƒˆãŒã‚ã‚Šã¾ã™ã€‚
    
    # ========================================
    # Phase 1: ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆè¨­è¨ˆãƒ»å®Ÿè¡Œ
    # ========================================
    - name: "confirm_unit_test_start"
      action: "confirm"
      message: |
        Phase 1: ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ ã‚’é–‹å§‹ã—ã¾ã™ã‹ï¼Ÿ
        
        å¯¾è±¡: {{test_strategy.unit_test_targets}}ä»¶ã®é–¢æ•°
        - åŸºç›¤é–¢æ•°ï¼ˆç’°å¢ƒå¤‰æ•°èª­ã¿è¾¼ã¿ã€ãƒãƒƒã‚·ãƒ¥è¨ˆç®—ãªã©ï¼‰
        - Markdownå¤‰æ›é–¢æ•°
        - Push/Pullé–¢æ•°
        - ãƒãƒ¼ã‚¸ãƒ­ã‚¸ãƒƒã‚¯
        
        pytestã§ã‚«ãƒãƒ¬ãƒƒã‚¸80%ä»¥ä¸Šã‚’ç›®æ¨™ã¨ã—ã¾ã™ã€‚
    
    - name: "generate_unit_test_plan"
      action: "analyze"
      data: ["{{test_strategy}}", "{{read_files(find_files(patterns=['**/dev_tasks.yaml']))}}"]
      instructions: |
        dev_tasks.yaml ã®å…¨ã‚¿ã‚¹ã‚¯ã‹ã‚‰æˆæœç‰©ãƒ•ã‚¡ã‚¤ãƒ«ãƒ»é–¢æ•°ã‚’æŠ½å‡ºã—ã€
        åŠ¹ç‡çš„ãªãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆè¨ˆç”»ã‚’ä½œæˆï¼š
        
        1. **ãƒ†ã‚¹ãƒˆã‚°ãƒ«ãƒ¼ãƒ—åŒ–**: é¡ä¼¼æ©Ÿèƒ½ã‚’ã¾ã¨ã‚ã‚‹ï¼ˆä¾‹: ç’°å¢ƒå¤‰æ•°ç³»ã€Markdownå¤‰æ›ç³»ï¼‰
        2. **å„ªå…ˆé †ä½ä»˜ã‘**: ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ãƒ‘ã‚¹ã®é–¢æ•°ã‚’å„ªå…ˆ
        3. **ä¾å­˜é–¢ä¿‚è€ƒæ…®**: ä¾å­˜é–¢æ•°ã‚’å…ˆã«ãƒ†ã‚¹ãƒˆ
        4. **ãƒ¢ãƒƒã‚¯æˆ¦ç•¥**: å¤–éƒ¨APIï¼ˆNotion APIï¼‰ã¯ãƒ¢ãƒƒã‚¯åŒ–
        5. **ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹æŠ½å‡º**: å„é–¢æ•°ã®å¢ƒç•Œå€¤ãƒ»ç•°å¸¸ç³»ãƒ†ã‚¹ãƒˆ
        
        å‡ºåŠ›å½¢å¼:
        - ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«åï¼ˆtest_xxx.pyï¼‰
        - ãƒ†ã‚¹ãƒˆå¯¾è±¡é–¢æ•°
        - ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ï¼ˆæ­£å¸¸ç³»ãƒ»ç•°å¸¸ç³»ï¼‰
        - ãƒ¢ãƒƒã‚¯å¯¾è±¡
        - æœŸå¾…ã‚«ãƒãƒ¬ãƒƒã‚¸
      store_as: "unit_test_plan"
    
    - name: "create_unit_test_master_plan"
      action: "create_markdown_file"
      path: "Flow/{{today}}/{{flow_dir}}/11_QAå®Ÿè¡Œ/unit_test_master_plan.md"
      content: |
        # ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆãƒã‚¹ã‚¿ãƒ¼ãƒ—ãƒ©ãƒ³
        
        ## æ¦‚è¦
        **ç›®æ¨™ã‚«ãƒãƒ¬ãƒƒã‚¸**: 80%ä»¥ä¸Š
        **å®Ÿè¡Œç’°å¢ƒ**: Python 3.8+, pytest
        **ç·ãƒ†ã‚¹ãƒˆæ•°**: {{unit_test_plan.total_tests}}ä»¶
        **æ¨å®šå®Ÿè¡Œæ™‚é–“**: {{unit_test_plan.estimated_time}}
        
        ## ãƒ†ã‚¹ãƒˆã‚°ãƒ«ãƒ¼ãƒ—
        {{#each unit_test_plan.groups}}
        ### Group {{@index}}: {{name}}
        **å„ªå…ˆåº¦**: {{priority}}
        **å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«**: {{target_files}}
        **ãƒ†ã‚¹ãƒˆæ•°**: {{test_count}}ä»¶
        
        #### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹
        {{#each test_cases}}
        - **{{function_name}}**
          - æ­£å¸¸ç³»: {{normal_cases}}
          - ç•°å¸¸ç³»: {{error_cases}}
          - ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹: {{edge_cases}}
          - ãƒ¢ãƒƒã‚¯: {{mocks}}
        {{/each}}
        {{/each}}
        
        ## å®Ÿè¡Œé †åºï¼ˆä¾å­˜é–¢ä¿‚è€ƒæ…®ï¼‰
        {{#each unit_test_plan.execution_order}}
        {{@index}}. {{test_file}} - {{description}}
        {{/each}}
        
        ## ãƒ¢ãƒƒã‚¯æˆ¦ç•¥
        - **Notion API**: `unittest.mock` ã§å…¨ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ãƒ¢ãƒƒã‚¯
        - **ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ **: `tempfile` ã§ä¸€æ™‚ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½¿ç”¨
        - **ç’°å¢ƒå¤‰æ•°**: `monkeypatch` ã§å‹•çš„è¨­å®š
        
        ## ã‚«ãƒãƒ¬ãƒƒã‚¸æ¸¬å®š
        ```bash
        pytest --cov=. --cov-report=html --cov-report=term
        ```
    
    - name: "generate_unit_tests_batch1"
      action: "create_markdown_file"
      path: "Flow/{{today}}/{{flow_dir}}/11_QAå®Ÿè¡Œ/unit_tests/test_env_loader.py"
      content: |
        """
        ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ: ç’°å¢ƒå¤‰æ•°èª­ã¿è¾¼ã¿é–¢æ•°
        å¯¾è±¡: c2n.py::_load_env_file(), _load_env_for_target()
        """
        import pytest
        import tempfile
        from pathlib import Path
        import os
        
        # ãƒ†ã‚¹ãƒˆå¯¾è±¡ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆï¼ˆãƒ‘ã‚¹ã¯èª¿æ•´ï¼‰
        import sys
        sys.path.insert(0, str(Path(__file__).parents[4] / 'dev'))
        from c2n import _load_env_file, _load_env_for_target
        
        
        class TestLoadEnvFile:
            """_load_env_file() ã®ãƒ†ã‚¹ãƒˆ"""
            
            def test_normal_case(self):
                """æ­£å¸¸ç³»: æ¨™æº–çš„ãª.envãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚ã‚‹"""
                with tempfile.NamedTemporaryFile(mode='w', delete=False, suffix='.env') as f:
                    f.write("NOTION_TOKEN=secret_xxx\n")
                    f.write("OTHER_VAR=value123\n")
                    env_path = Path(f.name)
                
                try:
                    env = _load_env_file(env_path)
                    assert env['NOTION_TOKEN'] == 'secret_xxx'
                    assert env['OTHER_VAR'] == 'value123'
                    assert len(env) == 2
                finally:
                    env_path.unlink()
            
            def test_with_comments(self):
                """æ­£å¸¸ç³»: ã‚³ãƒ¡ãƒ³ãƒˆè¡Œã‚’ç„¡è¦–ã™ã‚‹"""
                with tempfile.NamedTemporaryFile(mode='w', delete=False, suffix='.env') as f:
                    f.write("# ã‚³ãƒ¡ãƒ³ãƒˆ\n")
                    f.write("NOTION_TOKEN=secret_xxx\n")
                    f.write("# åˆ¥ã®ã‚³ãƒ¡ãƒ³ãƒˆ\n")
                    env_path = Path(f.name)
                
                try:
                    env = _load_env_file(env_path)
                    assert '# ã‚³ãƒ¡ãƒ³ãƒˆ' not in env
                    assert 'NOTION_TOKEN' in env
                finally:
                    env_path.unlink()
            
            def test_empty_lines(self):
                """æ­£å¸¸ç³»: ç©ºè¡Œã‚’ç„¡è¦–ã™ã‚‹"""
                with tempfile.NamedTemporaryFile(mode='w', delete=False, suffix='.env') as f:
                    f.write("\n")
                    f.write("NOTION_TOKEN=secret_xxx\n")
                    f.write("\n\n")
                    env_path = Path(f.name)
                
                try:
                    env = _load_env_file(env_path)
                    assert len(env) == 1
                finally:
                    env_path.unlink()
            
            def test_file_not_found(self):
                """ç•°å¸¸ç³»: ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ãªã„å ´åˆã¯ç©ºè¾æ›¸ã‚’è¿”ã™"""
                env = _load_env_file(Path('/nonexistent/.env'))
                assert env == {}
            
            def test_malformed_line(self):
                """ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹: =ãŒãªã„è¡Œã¯ç„¡è¦–"""
                with tempfile.NamedTemporaryFile(mode='w', delete=False, suffix='.env') as f:
                    f.write("NOTION_TOKEN=secret_xxx\n")
                    f.write("MALFORMED_LINE\n")
                    env_path = Path(f.name)
                
                try:
                    env = _load_env_file(env_path)
                    assert 'NOTION_TOKEN' in env
                    assert 'MALFORMED_LINE' not in env
                finally:
                    env_path.unlink()
        
        
        class TestLoadEnvForTarget:
            """_load_env_for_target() ã®ãƒ†ã‚¹ãƒˆ"""
            
            def test_from_environment_variable(self, monkeypatch):
                """å„ªå…ˆé †ä½1: ç’°å¢ƒå¤‰æ•°ã‹ã‚‰èª­ã¿è¾¼ã‚€"""
                monkeypatch.setenv('NOTION_TOKEN', 'env_token_123')
                
                with tempfile.TemporaryDirectory() as tmpdir:
                    target_dir = Path(tmpdir)
                    token = _load_env_for_target(target_dir)
                    assert token == 'env_token_123'
            
            def test_from_c2n_env(self, monkeypatch):
                """å„ªå…ˆé †ä½2: target_dir/.c2n/.envã‹ã‚‰èª­ã¿è¾¼ã‚€"""
                monkeypatch.delenv('NOTION_TOKEN', raising=False)
                
                with tempfile.TemporaryDirectory() as tmpdir:
                    target_dir = Path(tmpdir)
                    c2n_dir = target_dir / '.c2n'
                    c2n_dir.mkdir()
                    
                    c2n_env = c2n_dir / '.env'
                    c2n_env.write_text('NOTION_TOKEN=c2n_token_456')
                    
                    token = _load_env_for_target(target_dir)
                    assert token == 'c2n_token_456'
            
            def test_priority_order(self, monkeypatch):
                """å„ªå…ˆé †ä½: ç’°å¢ƒå¤‰æ•° > .c2n/.env > ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ/.env"""
                monkeypatch.setenv('NOTION_TOKEN', 'env_highest_priority')
                
                with tempfile.TemporaryDirectory() as tmpdir:
                    target_dir = Path(tmpdir)
                    c2n_dir = target_dir / '.c2n'
                    c2n_dir.mkdir()
                    
                    # ä½å„ªå…ˆåº¦ã®è¨­å®š
                    (target_dir / '.env').write_text('NOTION_TOKEN=project_low_priority')
                    (c2n_dir / '.env').write_text('NOTION_TOKEN=c2n_medium_priority')
                    
                    # ç’°å¢ƒå¤‰æ•°ãŒæœ€å„ªå…ˆ
                    token = _load_env_for_target(target_dir)
                    assert token == 'env_highest_priority'
            
            def test_token_not_found(self, monkeypatch):
                """ç•°å¸¸ç³»: ãƒˆãƒ¼ã‚¯ãƒ³ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã¯ValueError"""
                monkeypatch.delenv('NOTION_TOKEN', raising=False)
                
                with tempfile.TemporaryDirectory() as tmpdir:
                    target_dir = Path(tmpdir)
                    
                    with pytest.raises(ValueError, match="NOTION_TOKEN not found"):
                        _load_env_for_target(target_dir)
        
        
        # pytestå®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰:
        # pytest test_env_loader.py -v --cov=c2n --cov-report=term
    
    - name: "checkpoint_unit_test_batch1"
      action: "display"
      content: |
        âœ… Batch 1ã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã—ã¾ã—ãŸ
        
        **ç”Ÿæˆãƒ•ã‚¡ã‚¤ãƒ«**:
        - test_env_loader.pyï¼ˆç’°å¢ƒå¤‰æ•°èª­ã¿è¾¼ã¿ç³»ï¼‰
        
        **æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³**:
        1. ç”Ÿæˆã•ã‚ŒãŸãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèª
        2. å¿…è¦ã«å¿œã˜ã¦ä¿®æ­£
        3. pytestå®Ÿè¡Œ: `cd dev && pytest unit_tests/test_env_loader.py -v`
        4. ã‚«ãƒãƒ¬ãƒƒã‚¸ç¢ºèª
        
        ç¶šã‘ã¦æ¬¡ã®Batchã‚’ç”Ÿæˆã—ã¾ã™ã‹ï¼Ÿ
    
    - name: "confirm_continue_unit_tests"
      action: "confirm"
      message: "Batch 2ï¼ˆMarkdownå¤‰æ›ç³»ï¼‰ã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã‚’ç”Ÿæˆã—ã¾ã™ã‹ï¼Ÿ"
    
    - name: "generate_unit_tests_batch2"
      action: "create_markdown_file"
      path: "Flow/{{today}}/{{flow_dir}}/11_QAå®Ÿè¡Œ/unit_tests/test_markdown_converter.py"
      content: |
        """
        ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ: Markdownå¤‰æ›é–¢æ•°
        å¯¾è±¡: md_to_blocks.py::convert_markdown_to_notion_blocks(), parse_inline_formatting()
        """
        import pytest
        import sys
        from pathlib import Path
        
        sys.path.insert(0, str(Path(__file__).parents[4] / 'dev'))
        from md_to_blocks import convert_markdown_to_notion_blocks, parse_inline_formatting
        
        
        class TestConvertMarkdownToNotionBlocks:
            """convert_markdown_to_notion_blocks() ã®ãƒ†ã‚¹ãƒˆ"""
            
            def test_heading_conversion(self):
                """æ­£å¸¸ç³»: è¦‹å‡ºã—ã®å¤‰æ›"""
                markdown = "# è¦‹å‡ºã—1\n## è¦‹å‡ºã—2\n### è¦‹å‡ºã—3"
                blocks = convert_markdown_to_notion_blocks(markdown)
                
                assert len(blocks) == 3
                assert blocks[0]['type'] == 'heading_1'
                assert blocks[0]['heading_1']['rich_text'][0]['text']['content'] == 'è¦‹å‡ºã—1'
                assert blocks[1]['type'] == 'heading_2'
                assert blocks[2]['type'] == 'heading_3'
            
            def test_list_conversion(self):
                """æ­£å¸¸ç³»: ãƒªã‚¹ãƒˆã®å¤‰æ›"""
                markdown = "- é …ç›®1\n- é …ç›®2\n1. ç•ªå·1\n2. ç•ªå·2"
                blocks = convert_markdown_to_notion_blocks(markdown)
                
                assert blocks[0]['type'] == 'bulleted_list_item'
                assert blocks[1]['type'] == 'bulleted_list_item'
                assert blocks[2]['type'] == 'numbered_list_item'
                assert blocks[3]['type'] == 'numbered_list_item'
            
            def test_code_block_conversion(self):
                """æ­£å¸¸ç³»: ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã®å¤‰æ›"""
                markdown = "```python\nprint('Hello')\n```"
                blocks = convert_markdown_to_notion_blocks(markdown)
                
                assert blocks[0]['type'] == 'code'
                assert blocks[0]['code']['language'] == 'python'
                assert "print('Hello')" in blocks[0]['code']['rich_text'][0]['text']['content']
            
            def test_paragraph_conversion(self):
                """æ­£å¸¸ç³»: é€šå¸¸æ®µè½ã®å¤‰æ›"""
                markdown = "ã“ã‚Œã¯æ®µè½ã§ã™ã€‚"
                blocks = convert_markdown_to_notion_blocks(markdown)
                
                assert blocks[0]['type'] == 'paragraph'
                assert blocks[0]['paragraph']['rich_text'][0]['text']['content'] == 'ã“ã‚Œã¯æ®µè½ã§ã™ã€‚'
            
            def test_empty_input(self):
                """ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹: ç©ºæ–‡å­—åˆ—"""
                blocks = convert_markdown_to_notion_blocks("")
                assert blocks == []
            
            def test_mixed_content(self):
                """æ­£å¸¸ç³»: è¤‡æ•°ã®è¦ç´ ãŒæ··åœ¨"""
                markdown = """# ã‚¿ã‚¤ãƒˆãƒ«
        
        æ®µè½ã§ã™ã€‚
        
        - ãƒªã‚¹ãƒˆ1
        - ãƒªã‚¹ãƒˆ2
        
        ```python
        code
        ```
        """
                blocks = convert_markdown_to_notion_blocks(markdown)
                
                types = [b['type'] for b in blocks]
                assert 'heading_1' in types
                assert 'paragraph' in types
                assert 'bulleted_list_item' in types
                assert 'code' in types
        
        
        class TestParseInlineFormatting:
            """parse_inline_formatting() ã®ãƒ†ã‚¹ãƒˆ"""
            
            def test_bold_text(self):
                """æ­£å¸¸ç³»: å¤ªå­—ã®è§£æ"""
                text = "ã“ã‚Œã¯**å¤ªå­—**ã§ã™"
                rich_text = parse_inline_formatting(text)
                
                assert len(rich_text) == 3
                assert rich_text[1]['annotations']['bold'] is True
                assert rich_text[1]['text']['content'] == 'å¤ªå­—'
            
            def test_no_formatting(self):
                """æ­£å¸¸ç³»: ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãªã—ã®ãƒ†ã‚­ã‚¹ãƒˆ"""
                text = "ãƒ—ãƒ¬ãƒ¼ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ"
                rich_text = parse_inline_formatting(text)
                
                assert len(rich_text) == 1
                assert rich_text[0]['text']['content'] == 'ãƒ—ãƒ¬ãƒ¼ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ'
                assert 'annotations' not in rich_text[0] or not rich_text[0].get('annotations', {}).get('bold')
            
            def test_multiple_bold(self):
                """æ­£å¸¸ç³»: è¤‡æ•°ã®å¤ªå­—"""
                text = "**å¤ªå­—1**ã¨**å¤ªå­—2**"
                rich_text = parse_inline_formatting(text)
                
                bold_count = sum(1 for r in rich_text if r.get('annotations', {}).get('bold'))
                assert bold_count == 2
            
            def test_empty_string(self):
                """ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹: ç©ºæ–‡å­—åˆ—"""
                rich_text = parse_inline_formatting("")
                assert len(rich_text) == 1
                assert rich_text[0]['text']['content'] == ''
        
        
        # pytestå®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰:
        # pytest test_markdown_converter.py -v --cov=md_to_blocks
    
    - name: "generate_unit_test_runner"
      action: "create_markdown_file"
      path: "Flow/{{today}}/{{flow_dir}}/11_QAå®Ÿè¡Œ/run_unit_tests.sh"
      content: |
        #!/bin/bash
        # ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚¹ã‚¯ãƒªãƒ—ãƒˆ
        
        set -e
        
        echo "ğŸ§ª ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œé–‹å§‹..."
        
        # ãƒ†ã‚¹ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•
        cd "$(dirname "$0")/unit_tests"
        
        # pytestå®Ÿè¡Œï¼ˆã‚«ãƒãƒ¬ãƒƒã‚¸ä»˜ãï¼‰
        pytest . -v \
          --cov=../../dev \
          --cov-report=html:../test_reports/coverage_html \
          --cov-report=term \
          --cov-report=json:../test_reports/coverage.json \
          --junitxml=../test_reports/junit.xml
        
        echo ""
        echo "âœ… ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆå®Œäº†"
        echo "ğŸ“Š ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆ: test_reports/coverage_html/index.html"
        echo "ğŸ“„ JUnit XML: test_reports/junit.xml"
    
    # ========================================
    # Phase 2: çµ±åˆãƒ†ã‚¹ãƒˆè¨­è¨ˆãƒ»å®Ÿè¡Œ
    # ========================================
    - name: "confirm_integration_test_start"
      action: "confirm"
      message: |
        Phase 2: çµ±åˆãƒ†ã‚¹ãƒˆ ã‚’é–‹å§‹ã—ã¾ã™ã‹ï¼Ÿ
        
        å¯¾è±¡: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚·ãƒŠãƒªã‚ªãƒ™ãƒ¼ã‚¹ã®ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆ
        - æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç«‹ã¡ä¸Šã’ãƒ•ãƒ­ãƒ¼
        - æ—¢å­˜ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåŒæœŸãƒ•ãƒ­ãƒ¼
        - ã‚³ãƒ³ãƒ•ãƒªã‚¯ãƒˆè§£æ±ºãƒ•ãƒ­ãƒ¼
        
        chrome-mcp ã‚’æ´»ç”¨ã—ã¦CLIæ“ä½œã‚’è‡ªå‹•åŒ–ã—ã¾ã™ã€‚
    
    - name: "generate_integration_test_scenarios"
      action: "analyze"
      data: [
        "{{test_strategy}}",
        "{{read_files(find_files(patterns=['**/total_development_spec.md']))}}",
        "{{read_files(find_files(patterns=['**/user_story_map.yaml']))}}"
      ]
      instructions: |
        total_development_spec.md ã®ã€Œç”»é¢ãƒ•ãƒ­ãƒ¼ã€ã¨ user_story_map.yaml ã®ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‹ã‚‰ã€
        çµ±åˆãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ªã‚’ç”Ÿæˆï¼š
        
        1. **ã‚·ãƒŠãƒªã‚ª1: æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç«‹ã¡ä¸Šã’**
           - install.shå®Ÿè¡Œ
           - nit init
           - .envè¨­å®š
           - nit repo clone
           - ãƒ­ãƒ¼ã‚«ãƒ«ç·¨é›†
           - nit push
        
        2. **ã‚·ãƒŠãƒªã‚ª2: æ—¢å­˜ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåŒæœŸ**
           - Notionå´ã§ç·¨é›†
           - nit pull --full
           - ã‚³ãƒ³ãƒ•ãƒªã‚¯ãƒˆç™ºç”Ÿ
           - æ‰‹å‹•è§£æ±º
           - nit push
        
        3. **ã‚·ãƒŠãƒªã‚ª3: å¤§è¦æ¨¡ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ**
           - 100ãƒ•ã‚¡ã‚¤ãƒ«ä»¥ä¸Šã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
           - nit push --changed-only
           - å·®åˆ†åŒæœŸç¢ºèª
        
        å„ã‚·ãƒŠãƒªã‚ªã«å¯¾ã—ã¦ï¼š
        - å‰ææ¡ä»¶
        - å®Ÿè¡Œã‚¹ãƒ†ãƒƒãƒ—
        - æœŸå¾…çµæœ
        - æ¤œè¨¼ãƒã‚¤ãƒ³ãƒˆ
        - chrome-mcp ã§ã®è‡ªå‹•åŒ–æ‰‹é †
      store_as: "integration_scenarios"
    
    - name: "create_integration_test_plan"
      action: "create_markdown_file"
      path: "Flow/{{today}}/{{flow_dir}}/11_QAå®Ÿè¡Œ/integration_test_plan.md"
      content: |
        # çµ±åˆãƒ†ã‚¹ãƒˆè¨ˆç”»
        
        ## æ¦‚è¦
        **ãƒ†ã‚¹ãƒˆç’°å¢ƒ**: å®Ÿéš›ã®Notion APIï¼ˆãƒ†ã‚¹ãƒˆç”¨ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ï¼‰
        **è‡ªå‹•åŒ–ãƒ„ãƒ¼ãƒ«**: chrome-mcpï¼ˆCLIæ“ä½œï¼‰
        **ç·ã‚·ãƒŠãƒªã‚ªæ•°**: {{integration_scenarios.total_scenarios}}ä»¶
        **æ¨å®šå®Ÿè¡Œæ™‚é–“**: {{integration_scenarios.estimated_time}}
        
        ## ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª
        {{#each integration_scenarios.scenarios}}
        ### ã‚·ãƒŠãƒªã‚ª {{@index}}: {{name}}
        **å„ªå…ˆåº¦**: {{priority}}
        **ã‚¹ãƒˆãƒ¼ãƒªãƒ¼**: {{related_stories}}
        
        #### å‰ææ¡ä»¶
        {{#each preconditions}}
        - {{.}}
        {{/each}}
        
        #### å®Ÿè¡Œã‚¹ãƒ†ãƒƒãƒ—
        {{#each steps}}
        {{@index}}. {{action}}
           - ã‚³ãƒãƒ³ãƒ‰: `{{command}}`
           - æœŸå¾…çµæœ: {{expected_result}}
        {{/each}}
        
        #### æ¤œè¨¼ãƒã‚¤ãƒ³ãƒˆ
        {{#each verification_points}}
        - {{.}}
        {{/each}}
        
        #### chrome-mcp è‡ªå‹•åŒ–
        ```javascript
        // ã‚·ãƒŠãƒªã‚ª{{@index}}ã®è‡ªå‹•åŒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
        {{automation_script}}
        ```
        {{/each}}
        
        ## å®Ÿè¡Œé †åº
        1. ç’°å¢ƒæº–å‚™ï¼ˆNotion ãƒ†ã‚¹ãƒˆãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ä½œæˆï¼‰
        2. ã‚·ãƒŠãƒªã‚ª1å®Ÿè¡Œ â†’ äººé–“ç¢ºèª
        3. ã‚·ãƒŠãƒªã‚ª2å®Ÿè¡Œ â†’ äººé–“ç¢ºèª
        4. ã‚·ãƒŠãƒªã‚ª3å®Ÿè¡Œ â†’ äººé–“ç¢ºèª
        5. çµæœãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
    
    - name: "generate_integration_test_scenario1"
      action: "create_markdown_file"
      path: "Flow/{{today}}/{{flow_dir}}/11_QAå®Ÿè¡Œ/integration_tests/scenario1_new_project.md"
      content: |
        # çµ±åˆãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª1: æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç«‹ã¡ä¸Šã’
        
        ## ç›®çš„
        ã‚¼ãƒ­ã‹ã‚‰æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ç«‹ã¡ä¸Šã’ã€Notionã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã¾ã§ã®å…¨ãƒ•ãƒ­ãƒ¼ã‚’æ¤œè¨¼
        
        ## å‰ææ¡ä»¶
        - Notion APIãƒˆãƒ¼ã‚¯ãƒ³ãŒæœ‰åŠ¹
        - Notionãƒ†ã‚¹ãƒˆãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ãŒå­˜åœ¨
        - ãƒ­ãƒ¼ã‚«ãƒ«ã«`cursor_to_notion`ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿
        
        ## å®Ÿè¡Œã‚¹ãƒ†ãƒƒãƒ—
        
        ### Step 1: install.shå®Ÿè¡Œ
        ```bash
        cd /path/to/cursor_to_notion
        ./install.sh
        ```
        
        **æœŸå¾…çµæœ**:
        - ä»®æƒ³ç’°å¢ƒ `venv_cursor_notion` ãŒä½œæˆã•ã‚Œã‚‹
        - `nit --help` ãŒå‹•ä½œã™ã‚‹
        - ã‚¨ã‚¤ãƒªã‚¢ã‚¹ç™»éŒ²å®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹
        
        **æ¤œè¨¼**:
        ```bash
        source venv_cursor_notion/bin/activate
        nit --help  # ãƒ˜ãƒ«ãƒ—ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
        ```
        
        ### Step 2: ãƒ†ã‚¹ãƒˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ
        ```bash
        mkdir -p ~/test_project
        cd ~/test_project
        ```
        
        ### Step 3: nit init
        ```bash
        nit init
        ```
        
        **æœŸå¾…çµæœ**:
        - `.c2n/config.json` ãŒç”Ÿæˆã•ã‚Œã‚‹
        - `.c2n/index.yaml` ãŒç”Ÿæˆã•ã‚Œã‚‹
        - `.c2n_ignore` ãŒç”Ÿæˆã•ã‚Œã‚‹
        
        **æ¤œè¨¼**:
        ```bash
        ls -la .c2n/
        cat .c2n/config.json  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã‚’ç¢ºèª
        ```
        
        ### Step 4: .envè¨­å®š
        ```bash
        echo "NOTION_TOKEN=secret_xxx" > .env
        ```
        
        **æœŸå¾…çµæœ**:
        - `.env` ãƒ•ã‚¡ã‚¤ãƒ«ãŒä½œæˆã•ã‚Œã‚‹
        
        ### Step 5: ã‚µãƒ³ãƒ—ãƒ«Markdownãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
        ```bash
        mkdir docs
        cat > docs/README.md << 'EOF'
        # ãƒ†ã‚¹ãƒˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ
        
        ã“ã‚Œã¯ãƒ†ã‚¹ãƒˆã§ã™ã€‚
        
        ## ã‚»ã‚¯ã‚·ãƒ§ãƒ³1
        - é …ç›®1
        - é …ç›®2
        
        ```python
        print("Hello, World!")
        ```
        EOF
        ```
        
        ### Step 6: nit dryrun
        ```bash
        nit dryrun
        ```
        
        **æœŸå¾…çµæœ**:
        - `[DRYRUN] Would create: docs/README.md` ãŒè¡¨ç¤ºã•ã‚Œã‚‹
        - å®Ÿéš›ã®ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆã¯è¡Œã‚ã‚Œãªã„
        
        ### Step 7: nit push
        ```bash
        nit push
        ```
        
        **æœŸå¾…çµæœ**:
        - é€²æ—è¡¨ç¤ºãŒè¡¨ç¤ºã•ã‚Œã‚‹
        - `âœ… Created: https://notion.so/xxxx` ãŒè¡¨ç¤ºã•ã‚Œã‚‹
        - Notionå´ã«ãƒšãƒ¼ã‚¸ãŒä½œæˆã•ã‚Œã‚‹
        
        **æ¤œè¨¼**:
        1. Notionãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹
        2. æ–°è¦ãƒšãƒ¼ã‚¸ãŒä½œæˆã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
        3. è¦‹å‡ºã—ã€ãƒªã‚¹ãƒˆã€ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ãŒæ­£ã—ãè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
        
        ### Step 8: åŒæœŸçŠ¶æ…‹ç¢ºèª
        ```bash
        nit status
        ```
        
        **æœŸå¾…çµæœ**:
        - `docs/README.md: Synced` ãŒè¡¨ç¤ºã•ã‚Œã‚‹
        - `last_sync_at` ãŒæ›´æ–°ã•ã‚Œã¦ã„ã‚‹
        
        ## æˆåŠŸåŸºæº–
        - [ ] å…¨ã‚¹ãƒ†ãƒƒãƒ—ãŒã‚¨ãƒ©ãƒ¼ãªãå®Œäº†
        - [ ] Notionå´ã«ãƒšãƒ¼ã‚¸ãŒæ­£ã—ãä½œæˆã•ã‚Œã‚‹
        - [ ] Markdownã®å„è¦ç´ ãŒæ­£ç¢ºã«å¤‰æ›ã•ã‚Œã‚‹
        - [ ] åŒæœŸçŠ¶æ…‹ãŒæ­£ã—ãè¨˜éŒ²ã•ã‚Œã‚‹
        
        ## chrome-mcp è‡ªå‹•åŒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
        
        **æ³¨**: chrome-mcpã¯ãƒ–ãƒ©ã‚¦ã‚¶æ“ä½œç”¨ã®ãŸã‚ã€CLIæ“ä½œã¯é€šå¸¸ã®ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§è‡ªå‹•åŒ–ã€‚
        Notionå´ã®è¡¨ç¤ºç¢ºèªã®ã¿chrome-mcpã‚’ä½¿ç”¨ã€‚
        
        ```javascript
        // Notionå´ã®è¡¨ç¤ºç¢ºèªï¼ˆchrome-mcpï¼‰
        const page = await browser.newPage();
        await page.goto('https://notion.so/{{page_id}}');
        
        // è¦‹å‡ºã—ã®ç¢ºèª
        const heading = await page.$('h1');
        const headingText = await heading.textContent();
        assert(headingText === 'ãƒ†ã‚¹ãƒˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ');
        
        // ãƒªã‚¹ãƒˆã®ç¢ºèª
        const listItems = await page.$$('li');
        assert(listItems.length === 2);
        
        // ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã®ç¢ºèª
        const codeBlock = await page.$('pre code');
        const codeText = await codeBlock.textContent();
        assert(codeText.includes('print("Hello, World!")'));
        
        console.log('âœ… ã‚·ãƒŠãƒªã‚ª1: å…¨æ¤œè¨¼å®Œäº†');
        ```
    
    - name: "checkpoint_integration_scenario1"
      action: "display"
      content: |
        âœ… çµ±åˆãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª1ã‚’ç”Ÿæˆã—ã¾ã—ãŸ
        
        **æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³**:
        1. ã‚·ãƒŠãƒªã‚ª1ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç¢ºèª
        2. Notionãƒ†ã‚¹ãƒˆãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã‚’æº–å‚™
        3. ã‚·ãƒŠãƒªã‚ªå®Ÿè¡Œ: æ‰‹å‹•ã¾ãŸã¯ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
        4. çµæœã‚’ãƒ¬ãƒãƒ¼ãƒˆã«è¨˜éŒ²
        
        ç¶šã‘ã¦ã‚·ãƒŠãƒªã‚ª2ã‚’ç”Ÿæˆã—ã¾ã™ã‹ï¼Ÿ
    
    # ========================================
    # Phase 3: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ
    # ========================================
    - name: "confirm_performance_test_start"
      action: "confirm"
      message: |
        Phase 3: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ ã‚’é–‹å§‹ã—ã¾ã™ã‹ï¼Ÿ
        
        å¯¾è±¡:
        - 100ãƒ•ã‚¡ã‚¤ãƒ«ä»¥ä¸Šã®å¤§è¦æ¨¡ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ
        - åŒæœŸæ™‚é–“ã®æ¸¬å®š
        - ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã®ç¢ºèª
        - SHA1ãƒãƒƒã‚·ãƒ¥ãƒ»å·®åˆ†æ¤œå‡ºã®åŠ¹ç‡ç¢ºèª
    
    - name: "generate_performance_test_plan"
      action: "create_markdown_file"
      path: "Flow/{{today}}/{{flow_dir}}/11_QAå®Ÿè¡Œ/performance_test_plan.md"
      content: |
        # ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆè¨ˆç”»
        
        ## æ¦‚è¦
        **ç›®æ¨™**: å¤§è¦æ¨¡ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã®å®Ÿç”¨æ€§ç¢ºèª
        **æ¸¬å®šé …ç›®**:
        1. åŒæœŸæ™‚é–“ï¼ˆå…¨ãƒ•ã‚¡ã‚¤ãƒ« vs å·®åˆ†ã®ã¿ï¼‰
        2. ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡
        3. SHA1ãƒãƒƒã‚·ãƒ¥è¨ˆç®—æ™‚é–“
        4. Notion APIå‘¼ã³å‡ºã—å›æ•°
        
        ## ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹
        
        ### Case 1: 100ãƒ•ã‚¡ã‚¤ãƒ«ã®åˆå›Push
        **æ¡ä»¶**:
        - 100å€‹ã®.mdãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆå„1KBï¼‰
        - éšå±¤æ§‹é€ : 10ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª Ã— 10ãƒ•ã‚¡ã‚¤ãƒ«
        
        **æ¸¬å®š**:
        ```bash
        time nit push
        ```
        
        **æœŸå¾…çµæœ**:
        - å®Ÿè¡Œæ™‚é–“: < 3åˆ†
        - ãƒ¡ãƒ¢ãƒªä½¿ç”¨: < 200MB
        - APIå‘¼ã³å‡ºã—: ~100å›ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«æ•°ç›¸å½“ï¼‰
        
        ### Case 2: å·®åˆ†åŒæœŸï¼ˆ10%å¤‰æ›´ï¼‰
        **æ¡ä»¶**:
        - 100ãƒ•ã‚¡ã‚¤ãƒ«ä¸­10ãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿å¤‰æ›´
        - `--changed-only` ãƒ•ãƒ©ã‚°ä½¿ç”¨
        
        **æ¸¬å®š**:
        ```bash
        time nit push --changed-only
        ```
        
        **æœŸå¾…çµæœ**:
        - å®Ÿè¡Œæ™‚é–“: < 30ç§’ï¼ˆ70%çŸ­ç¸®ï¼‰
        - å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿åŒæœŸ
        - SHA1ãƒãƒƒã‚·ãƒ¥ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒæœ‰åŠ¹
        
        ### Case 3: Pullï¼ˆå¤§é‡ãƒšãƒ¼ã‚¸ï¼‰
        **æ¡ä»¶**:
        - Notionå´ã«100ãƒšãƒ¼ã‚¸å­˜åœ¨
        - å…¨ãƒšãƒ¼ã‚¸å–å¾—
        
        **æ¸¬å®š**:
        ```bash
        time nit pull --full
        ```
        
        **æœŸå¾…çµæœ**:
        - å®Ÿè¡Œæ™‚é–“: < 5åˆ†
        - ãƒ¡ãƒ¢ãƒªä½¿ç”¨: < 300MB
        - last_edited_time ä¸¦åˆ—å–å¾—ãŒæœ‰åŠ¹
        
        ## æ¸¬å®šã‚¹ã‚¯ãƒªãƒ—ãƒˆ
        ```bash
        #!/bin/bash
        # performance_test.sh
        
        echo "ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆé–‹å§‹"
        
        # ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
        ./generate_test_data.sh 100
        
        # Case 1: åˆå›Push
        echo "Case 1: åˆå›Push"
        /usr/bin/time -v nit push 2>&1 | tee perf_case1.log
        
        # Case 2: å·®åˆ†åŒæœŸ
        echo "Case 2: å·®åˆ†åŒæœŸ"
        # 10ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¤‰æ›´
        ./modify_files.sh 10
        /usr/bin/time -v nit push --changed-only 2>&1 | tee perf_case2.log
        
        # Case 3: Pull
        echo "Case 3: Pull"
        /usr/bin/time -v nit pull --full 2>&1 | tee perf_case3.log
        
        # ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
        python generate_perf_report.py perf_case*.log
        ```
        
        ## æˆåŠŸåŸºæº–
        - [ ] å…¨ã‚±ãƒ¼ã‚¹ãŒç›®æ¨™æ™‚é–“å†…ã«å®Œäº†
        - [ ] ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ãŒè¨±å®¹ç¯„å›²å†…
        - [ ] å·®åˆ†åŒæœŸã§70%ä»¥ä¸Šã®æ™‚é–“çŸ­ç¸®
        - [ ] APIå‘¼ã³å‡ºã—å›æ•°ãŒæœ€é©åŒ–ã•ã‚Œã¦ã„ã‚‹
    
    # ========================================
    # Phase 4: ç·åˆãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
    # ========================================
    - name: "generate_qa_summary_report"
      action: "create_markdown_file"
      path: "Flow/{{today}}/{{flow_dir}}/11_QAå®Ÿè¡Œ/qa_summary_report.md"
      content: |
        # QAå®Ÿè¡Œã‚µãƒãƒªãƒ¼ãƒ¬ãƒãƒ¼ãƒˆ
        
        **å®Ÿè¡Œæ—¥æ™‚**: {{today}}
        **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ**: {{project_name}}
        **ãƒ†ã‚¹ãƒˆå¯¾è±¡**: {{test_strategy.total_tasks}}ã‚¿ã‚¹ã‚¯
        
        ## Phase 1: ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆçµæœ
        **å®Ÿè¡Œãƒ†ã‚¹ãƒˆæ•°**: {{unit_test_results.total_tests}}ä»¶
        **æˆåŠŸ**: {{unit_test_results.passed}}ä»¶
        **å¤±æ•—**: {{unit_test_results.failed}}ä»¶
        **ã‚¹ã‚­ãƒƒãƒ—**: {{unit_test_results.skipped}}ä»¶
        **ã‚«ãƒãƒ¬ãƒƒã‚¸**: {{unit_test_results.coverage}}%
        
        ### è©³ç´°
        {{#each unit_test_results.details}}
        - **{{test_file}}**: {{status}} ({{execution_time}}ç§’)
        {{/each}}
        
        ### å¤±æ•—ã—ãŸãƒ†ã‚¹ãƒˆ
        {{#each unit_test_results.failures}}
        - {{test_name}}: {{error_message}}
        {{/each}}
        
        ## Phase 2: çµ±åˆãƒ†ã‚¹ãƒˆçµæœ
        **å®Ÿè¡Œã‚·ãƒŠãƒªã‚ªæ•°**: {{integration_test_results.total_scenarios}}ä»¶
        **æˆåŠŸ**: {{integration_test_results.passed}}ä»¶
        **å¤±æ•—**: {{integration_test_results.failed}}ä»¶
        
        ### è©³ç´°
        {{#each integration_test_results.scenarios}}
        - **ã‚·ãƒŠãƒªã‚ª{{@index}}**: {{name}} - {{status}}
          - å®Ÿè¡Œæ™‚é–“: {{execution_time}}
          - æ¤œè¨¼ãƒã‚¤ãƒ³ãƒˆ: {{verified_points}}/{{total_points}}
        {{/each}}
        
        ## Phase 3: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆçµæœ
        **Case 1 (åˆå›Push)**: {{perf_case1.time}}ç§’, {{perf_case1.memory}}MB
        **Case 2 (å·®åˆ†åŒæœŸ)**: {{perf_case2.time}}ç§’, {{perf_case2.memory}}MB
        **Case 3 (Pull)**: {{perf_case3.time}}ç§’, {{perf_case3.memory}}MB
        
        **æ™‚é–“çŸ­ç¸®ç‡**: {{time_reduction}}%
        
        ## ç·åˆè©•ä¾¡
        {{#if all_tests_passed}}
        âœ… **åˆæ ¼**: å…¨ãƒ†ã‚¹ãƒˆãŒæˆåŠŸã—ã¾ã—ãŸ
        {{else}}
        âš ï¸ **ä¸åˆæ ¼**: ä¸€éƒ¨ãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã—ã¦ã„ã¾ã™
        {{/if}}
        
        ### æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
        {{#each recommended_actions}}
        - {{.}}
        {{/each}}
        
        ## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—
        1. å¤±æ•—ã—ãŸãƒ†ã‚¹ãƒˆã®ä¿®æ­£
        2. ã‚«ãƒãƒ¬ãƒƒã‚¸80%æœªæº€ã®ç®‡æ‰€ã®è¿½åŠ ãƒ†ã‚¹ãƒˆ
        3. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ”¹å–„ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
        4. ãƒªãƒªãƒ¼ã‚¹åˆ¤å®š
    
    - name: "notify_qa_completion"
      action: "display"
      content: |
        âœ… QAå®Ÿè¡Œãƒ—ãƒ­ã‚»ã‚¹ãŒå®Œäº†ã—ã¾ã—ãŸ
        
        **ç”Ÿæˆã•ã‚ŒãŸãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**:
        - unit_test_master_plan.mdï¼ˆãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆè¨ˆç”»ï¼‰
        - unit_tests/*.pyï¼ˆå€‹åˆ¥ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼‰
        - run_unit_tests.shï¼ˆå®Ÿè¡Œã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼‰
        - integration_test_plan.mdï¼ˆçµ±åˆãƒ†ã‚¹ãƒˆè¨ˆç”»ï¼‰
        - integration_tests/scenario*.mdï¼ˆã‚·ãƒŠãƒªã‚ªè©³ç´°ï¼‰
        - performance_test_plan.mdï¼ˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆè¨ˆç”»ï¼‰
        - qa_summary_report.mdï¼ˆç·åˆãƒ¬ãƒãƒ¼ãƒˆï¼‰
        
        **æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³**:
        1. å„Phaseã®ãƒ†ã‚¹ãƒˆã‚’æ®µéšçš„ã«å®Ÿè¡Œ
        2. äººé–“ç¢ºèªãƒã‚¤ãƒ³ãƒˆã§çµæœã‚’ãƒ¬ãƒ“ãƒ¥ãƒ¼
        3. qa_summary_report.md ã«çµæœã‚’è¨˜éŒ²
        4. å¿…è¦ã«å¿œã˜ã¦ãƒ†ã‚¹ãƒˆã‚’è¿½åŠ ãƒ»ä¿®æ­£
        
        å…¨ãƒ†ã‚¹ãƒˆãŒå®Œäº†ã—ãŸã‚‰ã€ãƒªãƒªãƒ¼ã‚¹åˆ¤å®šã«é€²ã‚“ã§ãã ã•ã„ã€‚
```

## æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰
â†’ `12_ãƒªãƒªãƒ¼ã‚¹åˆ¤å®š` ã§ãƒªãƒªãƒ¼ã‚¹å¯å¦ã‚’ç·åˆè©•ä¾¡

## å¤‰æ›´ç‚¹ï¼ˆv1.0 - QAå®Ÿè¡Œãƒ—ãƒ­ã‚»ã‚¹ï¼‰
- **æ®µéšçš„å®Ÿè¡Œ**: HITLæ„è­˜ã®Phaseåˆ†å‰²ï¼ˆUnit â†’ Integration â†’ Performanceï¼‰
- **åŠ¹ç‡çš„è¨­è¨ˆ**: dev_tasks.yamlå…¨ã‚¿ã‚¹ã‚¯ã‚’è§£æã—ã¦é‡è¤‡ãªãç¶²ç¾…
- **pytestçµ±åˆ**: ã‚«ãƒãƒ¬ãƒƒã‚¸æ¸¬å®šã€JUnit XMLãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
- **chrome-mcpæ´»ç”¨**: çµ±åˆãƒ†ã‚¹ãƒˆã®Notionè¡¨ç¤ºç¢ºèªè‡ªå‹•åŒ–
- **äººé–“ç¢ºèªãƒã‚¤ãƒ³ãƒˆ**: å„Phaseå®Œäº†æ™‚ã®ç¢ºèªãƒ—ãƒ­ã‚»ã‚¹
- **è©³ç´°ãƒ¬ãƒãƒ¼ãƒˆ**: ç·åˆQAã‚µãƒãƒªãƒ¼ãƒ¬ãƒãƒ¼ãƒˆè‡ªå‹•ç”Ÿæˆ






















