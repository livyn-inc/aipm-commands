---
name: ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆä½œæˆï¼ˆpytestè‡ªå‹•ç”Ÿæˆï¼‰
---

# 11-1 : ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆä½œæˆï¼ˆAIPMãƒãƒƒã‚«ã‚½ãƒ³ï¼‰- pytestè‡ªå‹•ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ç”Ÿæˆ

## å‰æ
- ç›´å‰ã« `07_é–‹ç™ºã‚¿ã‚¹ã‚¯åˆ†è§£` ãŒå®Œäº†æ¸ˆã¿ï¼ˆdev_tasks.yaml, total_development_spec.md ãŒå­˜åœ¨ï¼‰
- å®Ÿè£…ã‚³ãƒ¼ãƒ‰ãŒå­˜åœ¨ã™ã‚‹ï¼ˆdev/src/ ã¾ãŸã¯ dev/ é…ä¸‹ï¼‰
- Pythonç’°å¢ƒãŒåˆ©ç”¨å¯èƒ½
- **pytest + coverage ã‚’æ´»ç”¨ã—ãŸãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆè‡ªå‹•ç”Ÿæˆ**

## ç›®çš„
- ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆè¨ˆç”»ã®è‡ªå‹•ä½œæˆ
- pytest ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã®è‡ªå‹•ç”Ÿæˆï¼ˆtest_*.pyï¼‰
- conftest.py, pytest.ini ã®è‡ªå‹•è¨­å®š
- ã‚«ãƒãƒ¬ãƒƒã‚¸80%ä»¥ä¸Šã‚’ç›®æ¨™ã¨ã—ãŸç¶²ç¾…çš„ãƒ†ã‚¹ãƒˆè¨­è¨ˆ
- ãƒ¢ãƒƒã‚¯æˆ¦ç•¥ã®æ˜ç¢ºåŒ–

## å®Ÿè¡Œæ‰‹é †
```yaml
- trigger: "(ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆä½œæˆ|å˜ä½“ãƒ†ã‚¹ãƒˆä½œæˆ|pytestä½œæˆ|UnitTestCreate)"
  priority: high
  steps:
    # ========================================
    # Phase 0: åˆæœŸåŒ–ãƒ»å®Ÿè£…ã‚³ãƒ¼ãƒ‰è§£æ
    # ========================================
    - name: "load_implementation_context"
      action: "analyze"
      data: [
        "{{read_files(find_files(patterns=['**/total_development_spec.md']))}}",
        "{{read_files(find_files(patterns=['**/dev_tasks.yaml']))}}",
        "{{read_files(find_files(patterns=['**/dev/**/*.py']))}}",
        "{{read_files(find_files(patterns=['**/dev/**/*.js']))}}",
        "{{read_files(find_files(patterns=['**/dev_runbook.md']))}}"
      ]
      instructions: |
        å®Ÿè£…ã‚³ãƒ¼ãƒ‰ã‚’è§£æã—ã€ä»¥ä¸‹ã‚’æŠ½å‡ºï¼š
        1. **ãƒ†ã‚¹ãƒˆå¯¾è±¡ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ»é–¢æ•°ãƒªã‚¹ãƒˆ**
           - Python: ã‚¯ãƒ©ã‚¹ãƒ»é–¢æ•°åã€å¼•æ•°ã€æˆ»ã‚Šå€¤
           - JavaScript: é–¢æ•°åã€ä¸»è¦ãªãƒ­ã‚¸ãƒƒã‚¯
        2. **ä¾å­˜é–¢ä¿‚ã®ç‰¹å®š**
           - å¤–éƒ¨APIå‘¼ã³å‡ºã—ï¼ˆNotion APIç­‰ï¼‰
           - ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ æ“ä½œ
           - ç’°å¢ƒå¤‰æ•°èª­ã¿è¾¼ã¿
        3. **ãƒ†ã‚¹ãƒˆã™ã¹ãã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹**
           - å¢ƒç•Œå€¤ã€ç•°å¸¸ç³»ã€ç©ºå…¥åŠ›
           - ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
        4. **ãƒ¢ãƒƒã‚¯å¯¾è±¡ã®ç‰¹å®š**
           - APIå‘¼ã³å‡ºã— â†’ ãƒ¢ãƒƒã‚¯å¿…é ˆ
           - ãƒ•ã‚¡ã‚¤ãƒ«I/O â†’ tempfileä½¿ç”¨
           - ç’°å¢ƒå¤‰æ•° â†’ monkeypatchä½¿ç”¨
        
        åŠ¹ç‡çš„ãªãƒ†ã‚¹ãƒˆã‚°ãƒ«ãƒ¼ãƒ—åŒ–æˆ¦ç•¥ã‚’ææ¡ˆã€‚
      store_as: "test_analysis"
    
    - name: "create_test_structure"
      action: "execute_shell"
      command: |
        mkdir -p "Flow/{{today}}/{{flow_dir}}/11-1_ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆä½œæˆ/tests" && \
        mkdir -p "Flow/{{today}}/{{flow_dir}}/11-1_ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆä½œæˆ/test_data" && \
        mkdir -p "Flow/{{today}}/{{flow_dir}}/11-1_ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆä½œæˆ/coverage_reports"
      message: "ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆç”¨ãƒ•ã‚©ãƒ«ãƒ€æ§‹é€ ã‚’ä½œæˆã—ã¾ã—ãŸ"
    
    - name: "display_test_analysis"
      action: "display"
      content: |
        ğŸ“Š ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆä½œæˆè¨ˆç”»
        â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
        
        **è§£æçµæœã‚µãƒãƒªãƒ¼**:
        {{test_analysis.summary}}
        
        **ãƒ†ã‚¹ãƒˆå¯¾è±¡ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«**: {{test_analysis.total_modules}}å€‹
        **ãƒ†ã‚¹ãƒˆå¯¾è±¡é–¢æ•°**: {{test_analysis.total_functions}}å€‹
        **æ¨å®šãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹æ•°**: {{test_analysis.estimated_test_cases}}ä»¶
        **ç›®æ¨™ã‚«ãƒãƒ¬ãƒƒã‚¸**: 80%ä»¥ä¸Š
        
        **ãƒ†ã‚¹ãƒˆã‚°ãƒ«ãƒ¼ãƒ—**:
        {{#each test_analysis.groups}}
        - **{{name}}**: {{description}} ({{test_count}}ä»¶)
        {{/each}}
        
        **ãƒ¢ãƒƒã‚¯æˆ¦ç•¥**:
        {{#each test_analysis.mock_strategy}}
        - {{target}}: {{method}}
        {{/each}}
    
    # ========================================
    # Phase 1: pytestè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆ
    # ========================================
    - name: "generate_pytest_ini"
      action: "create_markdown_file"
      path: "Flow/{{today}}/{{flow_dir}}/11-1_ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆä½œæˆ/pytest.ini"
      content: |
        [pytest]
        # pytestè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
        
        # ãƒ†ã‚¹ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
        testpaths = tests
        
        # ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«åãƒ‘ã‚¿ãƒ¼ãƒ³
        python_files = test_*.py
        python_classes = Test*
        python_functions = test_*
        
        # å‡ºåŠ›è¨­å®š
        addopts = 
            -v
            --strict-markers
            --tb=short
            --cov=../dev
            --cov-report=html:coverage_reports/html
            --cov-report=term-missing
            --cov-report=json:coverage_reports/coverage.json
            --cov-branch
            --cov-fail-under=80
        
        # ãƒãƒ¼ã‚«ãƒ¼å®šç¾©
        markers =
            unit: ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼ˆé«˜é€Ÿãƒ»ãƒ¢ãƒƒã‚¯ä½¿ç”¨ï¼‰
            integration: çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆå®ŸAPIä½¿ç”¨ï¼‰
            slow: å®Ÿè¡Œã«æ™‚é–“ãŒã‹ã‹ã‚‹ãƒ†ã‚¹ãƒˆ
            skip_ci: CIç’°å¢ƒã§ã¯ã‚¹ã‚­ãƒƒãƒ—
        
        # ã‚«ãƒãƒ¬ãƒƒã‚¸é™¤å¤–ãƒ‘ã‚¿ãƒ¼ãƒ³
        [coverage:run]
        omit = 
            */tests/*
            */venv/*
            */__pycache__/*
            */test_*.py
        
        [coverage:report]
        precision = 2
        show_missing = True
        skip_covered = False
    
    - name: "generate_conftest"
      action: "analyze"
      data: ["{{test_analysis}}"]
      instructions: |
        test_analysis ã‹ã‚‰å…±é€šãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£ã‚’è¨­è¨ˆã—ã€conftest.py ã‚’ç”Ÿæˆï¼š
        
        1. **ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£**
           - ä¸€æ™‚ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ
           - ãƒ†ã‚¹ãƒˆç”¨ç’°å¢ƒå¤‰æ•°è¨­å®š
           - ãƒ¢ãƒƒã‚¯ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå…±é€šåˆæœŸåŒ–
        
        2. **ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£**
           - temp_project_dir: ä¸€æ™‚ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
           - sample_md_file: ã‚µãƒ³ãƒ—ãƒ«Markdownãƒ•ã‚¡ã‚¤ãƒ«
           - sample_config: ãƒ†ã‚¹ãƒˆç”¨è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
        
        3. **ãƒ¢ãƒƒã‚¯ãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£**
           - mock_notion_client: Notion APIãƒ¢ãƒƒã‚¯
           - mock_env: ç’°å¢ƒå¤‰æ•°ãƒ¢ãƒƒã‚¯
        
        4. **ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£**
           - sample_blocks: Notionãƒ–ãƒ­ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿
           - sample_page_response: APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚µãƒ³ãƒ—ãƒ«
        
        Python ã‚³ãƒ¼ãƒ‰ã§è¿”ã™ã€‚
      store_as: "conftest_code"
    
    - name: "create_conftest"
      action: "create_markdown_file"
      path: "Flow/{{today}}/{{flow_dir}}/11-1_ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆä½œæˆ/tests/conftest.py"
      content: |
        """
        pytestå…±é€šãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£å®šç¾©
        å…¨ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã§åˆ©ç”¨å¯èƒ½ãªå…±é€šã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        """
        import pytest
        import tempfile
        from pathlib import Path
        import os
        import json
        from unittest.mock import Mock, MagicMock
        
        
        # ========================================
        # ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£
        # ========================================
        
        @pytest.fixture
        def temp_project_dir():
            """ä¸€æ™‚ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆ"""
            with tempfile.TemporaryDirectory() as tmpdir:
                yield Path(tmpdir)
        
        
        @pytest.fixture
        def sample_md_file(temp_project_dir):
            """ã‚µãƒ³ãƒ—ãƒ«Markdownãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ"""
            md_file = temp_project_dir / "sample.md"
            content = """# ã‚µãƒ³ãƒ—ãƒ«ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
        
        ã“ã‚Œã¯ãƒ†ã‚¹ãƒˆç”¨ã®Markdownãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚
        
        ## ã‚»ã‚¯ã‚·ãƒ§ãƒ³1
        - é …ç›®1
        - é …ç›®2
        
        ## ã‚»ã‚¯ã‚·ãƒ§ãƒ³2
        
        ```python
        def hello():
            print("Hello, World!")
        ```
        
        **é‡è¦**: ã“ã‚Œã¯å¤ªå­—ã§ã™ã€‚
        """
            md_file.write_text(content)
            return md_file
        
        
        @pytest.fixture
        def sample_config(temp_project_dir):
            """ãƒ†ã‚¹ãƒˆç”¨è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ"""
            config_dir = temp_project_dir / ".c2n"
            config_dir.mkdir()
            
            config = {
                "root_page_id": "test_root_page_id_123",
                "database_id": "test_database_id_456",
                "sync_mode": "push",
                "ignore_patterns": ["*.tmp", "__pycache__"]
            }
            
            config_file = config_dir / "config.json"
            config_file.write_text(json.dumps(config, indent=2))
            
            return config_file
        
        
        @pytest.fixture
        def sample_env_file(temp_project_dir):
            """ãƒ†ã‚¹ãƒˆç”¨.envãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ"""
            env_file = temp_project_dir / ".env"
            env_content = "NOTION_TOKEN=secret_test_token_xxx\nWORKSPACE_ID=test_workspace_123\n"
            env_file.write_text(env_content)
            return env_file
        
        
        # ========================================
        # ãƒ¢ãƒƒã‚¯ãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£
        # ========================================
        
        @pytest.fixture
        def mock_notion_client():
            """Notion APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ãƒ¢ãƒƒã‚¯"""
            client = MagicMock()
            
            # pages.create ã®ãƒ¢ãƒƒã‚¯
            client.pages.create.return_value = {
                "id": "mock_page_id_123",
                "url": "https://notion.so/mock_page_123",
                "properties": {},
                "created_time": "2025-10-14T00:00:00.000Z",
                "last_edited_time": "2025-10-14T00:00:00.000Z"
            }
            
            # pages.update ã®ãƒ¢ãƒƒã‚¯
            client.pages.update.return_value = {
                "id": "mock_page_id_123",
                "url": "https://notion.so/mock_page_123"
            }
            
            # pages.retrieve ã®ãƒ¢ãƒƒã‚¯
            client.pages.retrieve.return_value = {
                "id": "mock_page_id_123",
                "properties": {
                    "title": {
                        "title": [{"text": {"content": "Test Page"}}]
                    }
                }
            }
            
            # blocks.children.append ã®ãƒ¢ãƒƒã‚¯
            client.blocks.children.append.return_value = {
                "results": [{"id": "block_id_1"}, {"id": "block_id_2"}]
            }
            
            return client
        
        
        @pytest.fixture
        def mock_env_vars(monkeypatch):
            """ç’°å¢ƒå¤‰æ•°ã®ãƒ¢ãƒƒã‚¯"""
            test_vars = {
                "NOTION_TOKEN": "secret_test_token",
                "WORKSPACE_ID": "test_workspace",
                "DEBUG": "true"
            }
            
            for key, value in test_vars.items():
                monkeypatch.setenv(key, value)
            
            return test_vars
        
        
        # ========================================
        # ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£
        # ========================================
        
        @pytest.fixture
        def sample_notion_blocks():
            """Notionãƒ–ãƒ­ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã®ã‚µãƒ³ãƒ—ãƒ«"""
            return [
                {
                    "object": "block",
                    "type": "heading_1",
                    "heading_1": {
                        "rich_text": [{"type": "text", "text": {"content": "è¦‹å‡ºã—1"}}]
                    }
                },
                {
                    "object": "block",
                    "type": "paragraph",
                    "paragraph": {
                        "rich_text": [{"type": "text", "text": {"content": "æ®µè½ãƒ†ã‚­ã‚¹ãƒˆ"}}]
                    }
                },
                {
                    "object": "block",
                    "type": "bulleted_list_item",
                    "bulleted_list_item": {
                        "rich_text": [{"type": "text", "text": {"content": "ãƒªã‚¹ãƒˆé …ç›®1"}}]
                    }
                }
            ]
        
        
        @pytest.fixture
        def sample_page_response():
            """Notion APIã®ãƒšãƒ¼ã‚¸ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚µãƒ³ãƒ—ãƒ«"""
            return {
                "object": "page",
                "id": "page_id_123",
                "created_time": "2025-10-14T00:00:00.000Z",
                "last_edited_time": "2025-10-14T01:00:00.000Z",
                "url": "https://notion.so/page_id_123",
                "properties": {
                    "title": {
                        "id": "title",
                        "type": "title",
                        "title": [{"type": "text", "text": {"content": "ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸"}}]
                    }
                }
            }
        
        
        @pytest.fixture
        def sample_hash_cache(temp_project_dir):
            """SHA1ãƒãƒƒã‚·ãƒ¥ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ã‚µãƒ³ãƒ—ãƒ«"""
            cache_file = temp_project_dir / ".c2n" / "hash_cache.json"
            cache_file.parent.mkdir(exist_ok=True)
            
            cache_data = {
                "files/doc1.md": "abc123def456",
                "files/doc2.md": "789xyz012uvw"
            }
            
            cache_file.write_text(json.dumps(cache_data, indent=2))
            return cache_file
        
        
        # ========================================
        # ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
        # ========================================
        
        def assert_blocks_equal(actual_blocks, expected_blocks):
            """Notionãƒ–ãƒ­ãƒƒã‚¯ãƒªã‚¹ãƒˆã®æ¯”è¼ƒãƒ˜ãƒ«ãƒ‘ãƒ¼"""
            assert len(actual_blocks) == len(expected_blocks), \
                f"ãƒ–ãƒ­ãƒƒã‚¯æ•°ãŒä¸€è‡´ã—ã¾ã›ã‚“: {len(actual_blocks)} != {len(expected_blocks)}"
            
            for i, (actual, expected) in enumerate(zip(actual_blocks, expected_blocks)):
                assert actual['type'] == expected['type'], \
                    f"ãƒ–ãƒ­ãƒƒã‚¯{i}ã®typeãŒä¸€è‡´ã—ã¾ã›ã‚“: {actual['type']} != {expected['type']}"
    
    - name: "display_pytest_config_complete"
      action: "display"
      content: |
        âœ… pytestè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆå®Œäº†
        
        **ç”Ÿæˆãƒ•ã‚¡ã‚¤ãƒ«**:
        - pytest.ini: pytestè¨­å®šï¼ˆã‚«ãƒãƒ¬ãƒƒã‚¸80%å¿…é ˆã€ãƒãƒ¼ã‚«ãƒ¼å®šç¾©ï¼‰
        - tests/conftest.py: å…±é€šãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã€ãƒ¢ãƒƒã‚¯ã€ãƒ‡ãƒ¼ã‚¿ï¼‰
        
        **åˆ©ç”¨å¯èƒ½ãªãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£**:
        - temp_project_dir: ä¸€æ™‚ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
        - sample_md_file: ã‚µãƒ³ãƒ—ãƒ«Markdownãƒ•ã‚¡ã‚¤ãƒ«
        - sample_config: ãƒ†ã‚¹ãƒˆç”¨è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
        - mock_notion_client: Notion APIãƒ¢ãƒƒã‚¯
        - mock_env_vars: ç’°å¢ƒå¤‰æ•°ãƒ¢ãƒƒã‚¯
        - sample_notion_blocks: Notionãƒ–ãƒ­ãƒƒã‚¯ã‚µãƒ³ãƒ—ãƒ«
    
    # ========================================
    # Phase 2: ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰è‡ªå‹•ç”Ÿæˆ
    # ========================================
    - name: "confirm_test_generation"
      action: "confirm"
      message: |
        Phase 2: ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰è‡ªå‹•ç”Ÿæˆã‚’é–‹å§‹ã—ã¾ã™ã‹ï¼Ÿ
        
        ä»¥ä¸‹ã®ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã—ã¾ã™ï¼š
        {{#each test_analysis.test_files}}
        - {{filename}}: {{description}} ({{test_count}}ä»¶)
        {{/each}}
    
    # Batch 1: ç’°å¢ƒå¤‰æ•°èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ
    - name: "generate_test_env_loader"
      action: "create_markdown_file"
      path: "Flow/{{today}}/{{flow_dir}}/11-1_ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆä½œæˆ/tests/test_env_loader.py"
      content: |
        """
        ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ: ç’°å¢ƒå¤‰æ•°èª­ã¿è¾¼ã¿æ©Ÿèƒ½
        å¯¾è±¡: ç’°å¢ƒå¤‰æ•°èª­ã¿è¾¼ã¿é–¢æ•°ï¼ˆ_load_env_file, _load_env_for_targetç­‰ï¼‰
        """
        import pytest
        import tempfile
        from pathlib import Path
        import os
        
        # ãƒ†ã‚¹ãƒˆå¯¾è±¡ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆï¼ˆãƒ‘ã‚¹ã¯å®Ÿè£…ã«å¿œã˜ã¦èª¿æ•´ï¼‰
        import sys
        sys.path.insert(0, str(Path(__file__).parents[4] / 'dev'))
        # from your_module import _load_env_file, _load_env_for_target
        
        
        @pytest.mark.unit
        class TestLoadEnvFile:
            """ç’°å¢ƒå¤‰æ•°ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ã®ãƒ†ã‚¹ãƒˆ"""
            
            def test_normal_env_file(self, temp_project_dir):
                """æ­£å¸¸ç³»: æ¨™æº–çš„ãª.envãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚ã‚‹"""
                env_file = temp_project_dir / ".env"
                env_file.write_text("NOTION_TOKEN=secret_xxx\nWORKSPACE_ID=workspace_123\n")
                
                # TODO: å®Ÿè£…ã«å¿œã˜ã¦é–¢æ•°å‘¼ã³å‡ºã—ã‚’è¿½åŠ 
                # result = _load_env_file(env_file)
                # assert result['NOTION_TOKEN'] == 'secret_xxx'
                # assert result['WORKSPACE_ID'] == 'workspace_123'
                pass
            
            def test_env_with_comments(self, temp_project_dir):
                """æ­£å¸¸ç³»: ã‚³ãƒ¡ãƒ³ãƒˆè¡Œã‚’ç„¡è¦–ã™ã‚‹"""
                env_file = temp_project_dir / ".env"
                env_file.write_text("# ã‚³ãƒ¡ãƒ³ãƒˆ\nNOTION_TOKEN=secret_xxx\n# åˆ¥ã®ã‚³ãƒ¡ãƒ³ãƒˆ\n")
                
                # TODO: å®Ÿè£…ã«å¿œã˜ã¦é–¢æ•°å‘¼ã³å‡ºã—ã‚’è¿½åŠ 
                # result = _load_env_file(env_file)
                # assert '# ã‚³ãƒ¡ãƒ³ãƒˆ' not in result
                # assert 'NOTION_TOKEN' in result
                pass
            
            def test_env_with_empty_lines(self, temp_project_dir):
                """æ­£å¸¸ç³»: ç©ºè¡Œã‚’ç„¡è¦–ã™ã‚‹"""
                env_file = temp_project_dir / ".env"
                env_file.write_text("\nNOTION_TOKEN=secret_xxx\n\n\n")
                
                # TODO: å®Ÿè£…ã«å¿œã˜ã¦é–¢æ•°å‘¼ã³å‡ºã—ã‚’è¿½åŠ 
                pass
            
            def test_file_not_found(self):
                """ç•°å¸¸ç³»: ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ãªã„å ´åˆ"""
                # TODO: å®Ÿè£…ã«å¿œã˜ã¦é–¢æ•°å‘¼ã³å‡ºã—ã‚’è¿½åŠ 
                # result = _load_env_file(Path('/nonexistent/.env'))
                # assert result == {}
                pass
            
            def test_malformed_line(self, temp_project_dir):
                """ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹: =ãŒãªã„è¡Œã¯ç„¡è¦–"""
                env_file = temp_project_dir / ".env"
                env_file.write_text("NOTION_TOKEN=secret_xxx\nMALFORMED_LINE\n")
                
                # TODO: å®Ÿè£…ã«å¿œã˜ã¦é–¢æ•°å‘¼ã³å‡ºã—ã‚’è¿½åŠ 
                pass
            
            def test_empty_value(self, temp_project_dir):
                """ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹: å€¤ãŒç©ºã®å¤‰æ•°"""
                env_file = temp_project_dir / ".env"
                env_file.write_text("EMPTY_VAR=\n")
                
                # TODO: å®Ÿè£…ã«å¿œã˜ã¦é–¢æ•°å‘¼ã³å‡ºã—ã‚’è¿½åŠ 
                pass
        
        
        @pytest.mark.unit
        class TestLoadEnvForTarget:
            """ç’°å¢ƒå¤‰æ•°å„ªå…ˆé †ä½èª­ã¿è¾¼ã¿ã®ãƒ†ã‚¹ãƒˆ"""
            
            def test_priority_env_variable(self, monkeypatch, temp_project_dir):
                """å„ªå…ˆé †ä½1: ç’°å¢ƒå¤‰æ•°ãŒæœ€å„ªå…ˆ"""
                monkeypatch.setenv('NOTION_TOKEN', 'env_token_highest')
                
                # ä½å„ªå…ˆåº¦ã®è¨­å®šã‚‚é…ç½®
                (temp_project_dir / ".env").write_text("NOTION_TOKEN=project_low")
                
                # TODO: å®Ÿè£…ã«å¿œã˜ã¦é–¢æ•°å‘¼ã³å‡ºã—ã‚’è¿½åŠ 
                # token = _load_env_for_target(temp_project_dir)
                # assert token == 'env_token_highest'
                pass
            
            def test_priority_c2n_env(self, monkeypatch, temp_project_dir):
                """å„ªå…ˆé †ä½2: .c2n/.env"""
                monkeypatch.delenv('NOTION_TOKEN', raising=False)
                
                c2n_dir = temp_project_dir / ".c2n"
                c2n_dir.mkdir()
                (c2n_dir / ".env").write_text("NOTION_TOKEN=c2n_token_medium")
                (temp_project_dir / ".env").write_text("NOTION_TOKEN=project_low")
                
                # TODO: å®Ÿè£…ã«å¿œã˜ã¦é–¢æ•°å‘¼ã³å‡ºã—ã‚’è¿½åŠ 
                pass
            
            def test_token_not_found(self, monkeypatch, temp_project_dir):
                """ç•°å¸¸ç³»: ãƒˆãƒ¼ã‚¯ãƒ³ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã¯ValueError"""
                monkeypatch.delenv('NOTION_TOKEN', raising=False)
                
                # TODO: å®Ÿè£…ã«å¿œã˜ã¦é–¢æ•°å‘¼ã³å‡ºã—ã‚’è¿½åŠ 
                # with pytest.raises(ValueError, match="NOTION_TOKEN not found"):
                #     _load_env_for_target(temp_project_dir)
                pass
        
        
        # pytestå®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰:
        # pytest tests/test_env_loader.py -v -m unit
    
    # Batch 2: Markdownå¤‰æ›ãƒ†ã‚¹ãƒˆ
    - name: "generate_test_markdown_converter"
      action: "create_markdown_file"
      path: "Flow/{{today}}/{{flow_dir}}/11-1_ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆä½œæˆ/tests/test_markdown_converter.py"
      content: |
        """
        ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ: Markdownå¤‰æ›æ©Ÿèƒ½
        å¯¾è±¡: Markdownâ†’Notionãƒ–ãƒ­ãƒƒã‚¯å¤‰æ›é–¢æ•°
        """
        import pytest
        from pathlib import Path
        import sys
        
        sys.path.insert(0, str(Path(__file__).parents[4] / 'dev'))
        # from your_module import convert_markdown_to_notion_blocks, parse_inline_formatting
        
        
        @pytest.mark.unit
        class TestConvertMarkdownToNotionBlocks:
            """Markdownâ†’Notionãƒ–ãƒ­ãƒƒã‚¯å¤‰æ›ã®ãƒ†ã‚¹ãƒˆ"""
            
            def test_heading_conversion(self):
                """æ­£å¸¸ç³»: è¦‹å‡ºã—ã®å¤‰æ›"""
                markdown = "# è¦‹å‡ºã—1\n## è¦‹å‡ºã—2\n### è¦‹å‡ºã—3"
                
                # TODO: å®Ÿè£…ã«å¿œã˜ã¦é–¢æ•°å‘¼ã³å‡ºã—ã‚’è¿½åŠ 
                # blocks = convert_markdown_to_notion_blocks(markdown)
                # assert len(blocks) == 3
                # assert blocks[0]['type'] == 'heading_1'
                # assert blocks[1]['type'] == 'heading_2'
                # assert blocks[2]['type'] == 'heading_3'
                pass
            
            def test_list_conversion(self):
                """æ­£å¸¸ç³»: ãƒªã‚¹ãƒˆã®å¤‰æ›"""
                markdown = "- é …ç›®1\n- é …ç›®2\n1. ç•ªå·1\n2. ç•ªå·2"
                
                # TODO: å®Ÿè£…ã«å¿œã˜ã¦é–¢æ•°å‘¼ã³å‡ºã—ã‚’è¿½åŠ 
                # blocks = convert_markdown_to_notion_blocks(markdown)
                # assert blocks[0]['type'] == 'bulleted_list_item'
                # assert blocks[2]['type'] == 'numbered_list_item'
                pass
            
            def test_code_block_conversion(self):
                """æ­£å¸¸ç³»: ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã®å¤‰æ›"""
                markdown = "```python\nprint('Hello')\n```"
                
                # TODO: å®Ÿè£…ã«å¿œã˜ã¦é–¢æ•°å‘¼ã³å‡ºã—ã‚’è¿½åŠ 
                # blocks = convert_markdown_to_notion_blocks(markdown)
                # assert blocks[0]['type'] == 'code'
                # assert blocks[0]['code']['language'] == 'python'
                pass
            
            def test_paragraph_conversion(self):
                """æ­£å¸¸ç³»: é€šå¸¸æ®µè½ã®å¤‰æ›"""
                markdown = "ã“ã‚Œã¯æ®µè½ã§ã™ã€‚"
                
                # TODO: å®Ÿè£…ã«å¿œã˜ã¦é–¢æ•°å‘¼ã³å‡ºã—ã‚’è¿½åŠ 
                pass
            
            def test_empty_input(self):
                """ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹: ç©ºæ–‡å­—åˆ—"""
                # TODO: å®Ÿè£…ã«å¿œã˜ã¦é–¢æ•°å‘¼ã³å‡ºã—ã‚’è¿½åŠ 
                # blocks = convert_markdown_to_notion_blocks("")
                # assert blocks == []
                pass
            
            def test_mixed_content(self, sample_md_file):
                """æ­£å¸¸ç³»: è¤‡æ•°ã®è¦ç´ ãŒæ··åœ¨ï¼ˆãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£æ´»ç”¨ï¼‰"""
                markdown = sample_md_file.read_text()
                
                # TODO: å®Ÿè£…ã«å¿œã˜ã¦é–¢æ•°å‘¼ã³å‡ºã—ã‚’è¿½åŠ 
                # blocks = convert_markdown_to_notion_blocks(markdown)
                # types = [b['type'] for b in blocks]
                # assert 'heading_1' in types
                # assert 'paragraph' in types
                # assert 'bulleted_list_item' in types
                # assert 'code' in types
                pass
            
            def test_nested_lists(self):
                """æ­£å¸¸ç³»: ãƒã‚¹ãƒˆã•ã‚ŒãŸãƒªã‚¹ãƒˆ"""
                markdown = "- è¦ªé …ç›®1\n  - å­é …ç›®1-1\n  - å­é …ç›®1-2\n- è¦ªé …ç›®2"
                
                # TODO: å®Ÿè£…ã«å¿œã˜ã¦é–¢æ•°å‘¼ã³å‡ºã—ã‚’è¿½åŠ 
                pass
            
            def test_table_conversion(self):
                """æ­£å¸¸ç³»: ãƒ†ãƒ¼ãƒ–ãƒ«ã®å¤‰æ›"""
                markdown = "| Header1 | Header2 |\n|---------|----------|\n| Cell1   | Cell2    |"
                
                # TODO: å®Ÿè£…ã«å¿œã˜ã¦é–¢æ•°å‘¼ã³å‡ºã—ã‚’è¿½åŠ 
                pass
        
        
        @pytest.mark.unit
        class TestParseInlineFormatting:
            """ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆè§£æã®ãƒ†ã‚¹ãƒˆ"""
            
            def test_bold_text(self):
                """æ­£å¸¸ç³»: å¤ªå­—ã®è§£æ"""
                text = "ã“ã‚Œã¯**å¤ªå­—**ã§ã™"
                
                # TODO: å®Ÿè£…ã«å¿œã˜ã¦é–¢æ•°å‘¼ã³å‡ºã—ã‚’è¿½åŠ 
                # rich_text = parse_inline_formatting(text)
                # assert rich_text[1]['annotations']['bold'] is True
                pass
            
            def test_italic_text(self):
                """æ­£å¸¸ç³»: æ–œä½“ã®è§£æ"""
                text = "ã“ã‚Œã¯*æ–œä½“*ã§ã™"
                
                # TODO: å®Ÿè£…ã«å¿œã˜ã¦é–¢æ•°å‘¼ã³å‡ºã—ã‚’è¿½åŠ 
                pass
            
            def test_code_inline(self):
                """æ­£å¸¸ç³»: ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚³ãƒ¼ãƒ‰ã®è§£æ"""
                text = "ã“ã‚Œã¯`code`ã§ã™"
                
                # TODO: å®Ÿè£…ã«å¿œã˜ã¦é–¢æ•°å‘¼ã³å‡ºã—ã‚’è¿½åŠ 
                pass
            
            def test_link(self):
                """æ­£å¸¸ç³»: ãƒªãƒ³ã‚¯ã®è§£æ"""
                text = "ã“ã‚Œã¯[ãƒªãƒ³ã‚¯](https://example.com)ã§ã™"
                
                # TODO: å®Ÿè£…ã«å¿œã˜ã¦é–¢æ•°å‘¼ã³å‡ºã—ã‚’è¿½åŠ 
                pass
            
            def test_no_formatting(self):
                """æ­£å¸¸ç³»: ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãªã—"""
                text = "ãƒ—ãƒ¬ãƒ¼ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ"
                
                # TODO: å®Ÿè£…ã«å¿œã˜ã¦é–¢æ•°å‘¼ã³å‡ºã—ã‚’è¿½åŠ 
                pass
            
            def test_multiple_bold(self):
                """æ­£å¸¸ç³»: è¤‡æ•°ã®å¤ªå­—"""
                text = "**å¤ªå­—1**ã¨**å¤ªå­—2**"
                
                # TODO: å®Ÿè£…ã«å¿œã˜ã¦é–¢æ•°å‘¼ã³å‡ºã—ã‚’è¿½åŠ 
                pass
            
            def test_empty_string(self):
                """ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹: ç©ºæ–‡å­—åˆ—"""
                # TODO: å®Ÿè£…ã«å¿œã˜ã¦é–¢æ•°å‘¼ã³å‡ºã—ã‚’è¿½åŠ 
                pass
        
        
        # pytestå®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰:
        # pytest tests/test_markdown_converter.py -v -m unit --cov=md_to_blocks
    
    # Batch 3: ãƒãƒƒã‚·ãƒ¥ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ†ã‚¹ãƒˆ
    - name: "generate_test_hash_cache"
      action: "create_markdown_file"
      path: "Flow/{{today}}/{{flow_dir}}/11-1_ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆä½œæˆ/tests/test_hash_cache.py"
      content: |
        """
        ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ: SHA1ãƒãƒƒã‚·ãƒ¥ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½
        å¯¾è±¡: ãƒãƒƒã‚·ãƒ¥è¨ˆç®—ãƒ»ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç®¡ç†é–¢æ•°
        """
        import pytest
        from pathlib import Path
        import json
        import sys
        
        sys.path.insert(0, str(Path(__file__).parents[4] / 'dev'))
        # from your_module import compute_file_hash, load_hash_cache, save_hash_cache, is_file_changed
        
        
        @pytest.mark.unit
        class TestComputeFileHash:
            """ãƒ•ã‚¡ã‚¤ãƒ«ãƒãƒƒã‚·ãƒ¥è¨ˆç®—ã®ãƒ†ã‚¹ãƒˆ"""
            
            def test_compute_hash_normal(self, temp_project_dir):
                """æ­£å¸¸ç³»: é€šå¸¸ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒãƒƒã‚·ãƒ¥è¨ˆç®—"""
                test_file = temp_project_dir / "test.txt"
                test_file.write_text("Hello, World!")
                
                # TODO: å®Ÿè£…ã«å¿œã˜ã¦é–¢æ•°å‘¼ã³å‡ºã—ã‚’è¿½åŠ 
                # hash_value = compute_file_hash(test_file)
                # assert isinstance(hash_value, str)
                # assert len(hash_value) == 40  # SHA1ã¯40æ–‡å­—
                pass
            
            def test_compute_hash_empty_file(self, temp_project_dir):
                """ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹: ç©ºãƒ•ã‚¡ã‚¤ãƒ«"""
                test_file = temp_project_dir / "empty.txt"
                test_file.write_text("")
                
                # TODO: å®Ÿè£…ã«å¿œã˜ã¦é–¢æ•°å‘¼ã³å‡ºã—ã‚’è¿½åŠ 
                # hash_value = compute_file_hash(test_file)
                # ç©ºãƒ•ã‚¡ã‚¤ãƒ«ã®SHA1: da39a3ee5e6b4b0d3255bfef95601890afd80709
                # assert hash_value == "da39a3ee5e6b4b0d3255bfef95601890afd80709"
                pass
            
            def test_compute_hash_large_file(self, temp_project_dir):
                """æ­£å¸¸ç³»: å¤§ããªãƒ•ã‚¡ã‚¤ãƒ«"""
                test_file = temp_project_dir / "large.txt"
                test_file.write_text("x" * 1_000_000)  # 1MB
                
                # TODO: å®Ÿè£…ã«å¿œã˜ã¦é–¢æ•°å‘¼ã³å‡ºã—ã‚’è¿½åŠ 
                pass
            
            def test_compute_hash_binary_file(self, temp_project_dir):
                """æ­£å¸¸ç³»: ãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«"""
                test_file = temp_project_dir / "binary.bin"
                test_file.write_bytes(bytes([0, 1, 2, 3, 255]))
                
                # TODO: å®Ÿè£…ã«å¿œã˜ã¦é–¢æ•°å‘¼ã³å‡ºã—ã‚’è¿½åŠ 
                pass
            
            def test_file_not_found(self):
                """ç•°å¸¸ç³»: ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ãªã„"""
                # TODO: å®Ÿè£…ã«å¿œã˜ã¦é–¢æ•°å‘¼ã³å‡ºã—ã‚’è¿½åŠ 
                # with pytest.raises(FileNotFoundError):
                #     compute_file_hash(Path('/nonexistent/file.txt'))
                pass
            
            def test_same_content_same_hash(self, temp_project_dir):
                """æ­£å¸¸ç³»: åŒã˜å†…å®¹ãªã‚‰åŒã˜ãƒãƒƒã‚·ãƒ¥"""
                file1 = temp_project_dir / "file1.txt"
                file2 = temp_project_dir / "file2.txt"
                content = "Same content"
                file1.write_text(content)
                file2.write_text(content)
                
                # TODO: å®Ÿè£…ã«å¿œã˜ã¦é–¢æ•°å‘¼ã³å‡ºã—ã‚’è¿½åŠ 
                # hash1 = compute_file_hash(file1)
                # hash2 = compute_file_hash(file2)
                # assert hash1 == hash2
                pass
        
        
        @pytest.mark.unit
        class TestHashCache:
            """ãƒãƒƒã‚·ãƒ¥ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç®¡ç†ã®ãƒ†ã‚¹ãƒˆ"""
            
            def test_load_cache_existing(self, sample_hash_cache):
                """æ­£å¸¸ç³»: æ—¢å­˜ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’èª­ã¿è¾¼ã‚€"""
                # TODO: å®Ÿè£…ã«å¿œã˜ã¦é–¢æ•°å‘¼ã³å‡ºã—ã‚’è¿½åŠ 
                # cache = load_hash_cache(sample_hash_cache)
                # assert "files/doc1.md" in cache
                # assert cache["files/doc1.md"] == "abc123def456"
                pass
            
            def test_load_cache_not_found(self, temp_project_dir):
                """æ­£å¸¸ç³»: ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ•ã‚¡ã‚¤ãƒ«ãŒãªã„å ´åˆã¯ç©ºè¾æ›¸"""
                cache_path = temp_project_dir / "nonexistent_cache.json"
                
                # TODO: å®Ÿè£…ã«å¿œã˜ã¦é–¢æ•°å‘¼ã³å‡ºã—ã‚’è¿½åŠ 
                # cache = load_hash_cache(cache_path)
                # assert cache == {}
                pass
            
            def test_save_cache(self, temp_project_dir):
                """æ­£å¸¸ç³»: ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ä¿å­˜"""
                cache_path = temp_project_dir / "cache.json"
                cache_data = {
                    "file1.md": "hash1",
                    "file2.md": "hash2"
                }
                
                # TODO: å®Ÿè£…ã«å¿œã˜ã¦é–¢æ•°å‘¼ã³å‡ºã—ã‚’è¿½åŠ 
                # save_hash_cache(cache_path, cache_data)
                # assert cache_path.exists()
                # loaded = json.loads(cache_path.read_text())
                # assert loaded == cache_data
                pass
            
            def test_save_cache_overwrites(self, sample_hash_cache):
                """æ­£å¸¸ç³»: æ—¢å­˜ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ä¸Šæ›¸ã"""
                new_cache = {"new_file.md": "new_hash"}
                
                # TODO: å®Ÿè£…ã«å¿œã˜ã¦é–¢æ•°å‘¼ã³å‡ºã—ã‚’è¿½åŠ 
                # save_hash_cache(sample_hash_cache, new_cache)
                # loaded = load_hash_cache(sample_hash_cache)
                # assert loaded == new_cache
                pass
        
        
        @pytest.mark.unit
        class TestIsFileChanged:
            """ãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´æ¤œçŸ¥ã®ãƒ†ã‚¹ãƒˆ"""
            
            def test_file_changed(self, temp_project_dir):
                """æ­£å¸¸ç³»: ãƒ•ã‚¡ã‚¤ãƒ«ãŒå¤‰æ›´ã•ã‚ŒãŸ"""
                test_file = temp_project_dir / "test.md"
                test_file.write_text("Original content")
                
                # TODO: å®Ÿè£…ã«å¿œã˜ã¦é–¢æ•°å‘¼ã³å‡ºã—ã‚’è¿½åŠ 
                # original_hash = compute_file_hash(test_file)
                # cache = {"test.md": original_hash}
                
                # ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¤‰æ›´
                # test_file.write_text("Modified content")
                
                # changed = is_file_changed(test_file, cache)
                # assert changed is True
                pass
            
            def test_file_unchanged(self, temp_project_dir):
                """æ­£å¸¸ç³»: ãƒ•ã‚¡ã‚¤ãƒ«ãŒå¤‰æ›´ã•ã‚Œã¦ã„ãªã„"""
                test_file = temp_project_dir / "test.md"
                test_file.write_text("Content")
                
                # TODO: å®Ÿè£…ã«å¿œã˜ã¦é–¢æ•°å‘¼ã³å‡ºã—ã‚’è¿½åŠ 
                # hash_value = compute_file_hash(test_file)
                # cache = {"test.md": hash_value}
                
                # changed = is_file_changed(test_file, cache)
                # assert changed is False
                pass
            
            def test_file_not_in_cache(self, temp_project_dir):
                """æ­£å¸¸ç³»: ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ãªã„æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«"""
                test_file = temp_project_dir / "new.md"
                test_file.write_text("New file")
                cache = {}
                
                # TODO: å®Ÿè£…ã«å¿œã˜ã¦é–¢æ•°å‘¼ã³å‡ºã—ã‚’è¿½åŠ 
                # changed = is_file_changed(test_file, cache)
                # assert changed is True
                pass
        
        
        # pytestå®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰:
        # pytest tests/test_hash_cache.py -v -m unit --cov=hash_utils
    
    # ========================================
    # Phase 3: ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚¹ã‚¯ãƒªãƒ—ãƒˆç”Ÿæˆ
    # ========================================
    - name: "generate_test_runner"
      action: "create_markdown_file"
      path: "Flow/{{today}}/{{flow_dir}}/11-1_ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆä½œæˆ/run_unit_tests.sh"
      content: |
        #!/bin/bash
        # ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚¹ã‚¯ãƒªãƒ—ãƒˆ
        
        set -e
        
        echo "ğŸ§ª ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œé–‹å§‹..."
        echo ""
        
        # ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•
        SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"
        cd "$SCRIPT_DIR"
        
        # Pythonä»®æƒ³ç’°å¢ƒã®ç¢ºèª
        if [ ! -d "venv" ]; then
            echo "âš ï¸  ä»®æƒ³ç’°å¢ƒãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚ä½œæˆã—ã¾ã™..."
            python3 -m venv venv
            source venv/bin/activate
            pip install -r requirements.txt
        else
            source venv/bin/activate
        fi
        
        # pytestã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ç¢ºèª
        if ! pip show pytest > /dev/null 2>&1; then
            echo "ğŸ“¦ pytestã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™..."
            pip install pytest pytest-cov pytest-mock
        fi
        
        # ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
        echo "ğŸƒ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­..."
        pytest tests/ -v \
          -m unit \
          --cov=../dev \
          --cov-report=html:coverage_reports/html \
          --cov-report=term-missing \
          --cov-report=json:coverage_reports/coverage.json \
          --junitxml=coverage_reports/junit.xml \
          --tb=short
        
        RESULT=$?
        
        echo ""
        if [ $RESULT -eq 0 ]; then
            echo "âœ… å…¨ãƒ†ã‚¹ãƒˆæˆåŠŸ"
        else
            echo "âŒ ãƒ†ã‚¹ãƒˆå¤±æ•—ï¼ˆè©³ç´°ã¯ä¸Šè¨˜ãƒ­ã‚°ã‚’ç¢ºèªï¼‰"
        fi
        
        echo ""
        echo "ğŸ“Š ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆ:"
        echo "  HTML: coverage_reports/html/index.html"
        echo "  JSON: coverage_reports/coverage.json"
        echo "  JUnit XML: coverage_reports/junit.xml"
        
        exit $RESULT
    
    - name: "generate_requirements_txt"
      action: "create_markdown_file"
      path: "Flow/{{today}}/{{flow_dir}}/11-1_ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆä½œæˆ/requirements.txt"
      content: |
        # ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆç”¨Pythonä¾å­˜é–¢ä¿‚
        
        # ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯
        pytest>=7.4.0
        pytest-cov>=4.1.0
        pytest-mock>=3.11.1
        
        # ã‚«ãƒãƒ¬ãƒƒã‚¸
        coverage>=7.2.0
        
        # ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³æ‹¡å¼µ
        pytest-html>=3.2.0
        
        # ä¸¦åˆ—å®Ÿè¡Œï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
        pytest-xdist>=3.3.0
        
        # å®Ÿè£…ã‚³ãƒ¼ãƒ‰ã®ä¾å­˜é–¢ä¿‚ï¼ˆå¿…è¦ã«å¿œã˜ã¦è¿½åŠ ï¼‰
        # requests>=2.31.0
        # notion-client>=2.0.0
    
    - name: "generate_test_readme"
      action: "create_markdown_file"
      path: "Flow/{{today}}/{{flow_dir}}/11-1_ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆä½œæˆ/README.md"
      content: |
        # ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚¬ã‚¤ãƒ‰
        
        ## æ¦‚è¦
        ã“ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã¯ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã¨pytestè¨­å®šãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚
        
        **ç›®æ¨™ã‚«ãƒãƒ¬ãƒƒã‚¸**: 80%ä»¥ä¸Š
        **ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯**: pytest
        **å®Ÿè¡Œç’°å¢ƒ**: Python 3.8+
        
        ## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 
        ```
        11-1_ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆä½œæˆ/
        â”œâ”€â”€ tests/
        â”‚   â”œâ”€â”€ conftest.py            # å…±é€šãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£
        â”‚   â”œâ”€â”€ test_env_loader.py     # ç’°å¢ƒå¤‰æ•°èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ
        â”‚   â”œâ”€â”€ test_markdown_converter.py  # Markdownå¤‰æ›ãƒ†ã‚¹ãƒˆ
        â”‚   â””â”€â”€ test_hash_cache.py     # ãƒãƒƒã‚·ãƒ¥ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ†ã‚¹ãƒˆ
        â”œâ”€â”€ test_data/                 # ãƒ†ã‚¹ãƒˆç”¨ãƒ‡ãƒ¼ã‚¿
        â”œâ”€â”€ coverage_reports/          # ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆï¼ˆå®Ÿè¡Œå¾Œç”Ÿæˆï¼‰
        â”œâ”€â”€ pytest.ini                 # pytestè¨­å®š
        â”œâ”€â”€ requirements.txt           # Pythonä¾å­˜é–¢ä¿‚
        â”œâ”€â”€ run_unit_tests.sh          # ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚¹ã‚¯ãƒªãƒ—ãƒˆ
        â””â”€â”€ README.md                  # ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«
        ```
        
        ## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        
        ### 1. ä»®æƒ³ç’°å¢ƒä½œæˆï¼ˆæ¨å¥¨ï¼‰
        ```bash
        cd 11-1_ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆä½œæˆ
        python3 -m venv venv
        source venv/bin/activate  # Windows: venv\Scripts\activate
        ```
        
        ### 2. ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
        ```bash
        pip install -r requirements.txt
        ```
        
        ## ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
        
        ### æ–¹æ³•1: ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œï¼ˆæ¨å¥¨ï¼‰
        ```bash
        ./run_unit_tests.sh
        ```
        
        ### æ–¹æ³•2: pytestç›´æ¥å®Ÿè¡Œ
        ```bash
        # å…¨ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
        pytest tests/ -v -m unit
        
        # ã‚«ãƒãƒ¬ãƒƒã‚¸ä»˜ãå®Ÿè¡Œ
        pytest tests/ -v -m unit --cov=../dev --cov-report=html
        
        # ç‰¹å®šã®ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿
        pytest tests/test_env_loader.py -v
        
        # ç‰¹å®šã®ãƒ†ã‚¹ãƒˆã‚¯ãƒ©ã‚¹ã®ã¿
        pytest tests/test_env_loader.py::TestLoadEnvFile -v
        
        # ç‰¹å®šã®ãƒ†ã‚¹ãƒˆé–¢æ•°ã®ã¿
        pytest tests/test_env_loader.py::TestLoadEnvFile::test_normal_env_file -v
        ```
        
        ### æ–¹æ³•3: ä¸¦åˆ—å®Ÿè¡Œï¼ˆé«˜é€ŸåŒ–ï¼‰
        ```bash
        pytest tests/ -v -m unit -n auto
        ```
        
        ## ã‚«ãƒãƒ¬ãƒƒã‚¸ç¢ºèª
        
        ### HTMLãƒ¬ãƒãƒ¼ãƒˆ
        ```bash
        pytest tests/ --cov=../dev --cov-report=html
        open coverage_reports/html/index.html  # ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ã
        ```
        
        ### ã‚¿ãƒ¼ãƒŸãƒŠãƒ«è¡¨ç¤º
        ```bash
        pytest tests/ --cov=../dev --cov-report=term-missing
        ```
        
        ### JSONå‡ºåŠ›ï¼ˆCIé€£æºç”¨ï¼‰
        ```bash
        pytest tests/ --cov=../dev --cov-report=json:coverage_reports/coverage.json
        ```
        
        ## ãƒ†ã‚¹ãƒˆãƒãƒ¼ã‚«ãƒ¼
        
        pytest.ini ã§å®šç¾©ã•ã‚ŒãŸãƒãƒ¼ã‚«ãƒ¼:
        
        - `@pytest.mark.unit`: ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼ˆé«˜é€Ÿãƒ»ãƒ¢ãƒƒã‚¯ä½¿ç”¨ï¼‰
        - `@pytest.mark.integration`: çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆå®ŸAPIä½¿ç”¨ï¼‰
        - `@pytest.mark.slow`: å®Ÿè¡Œã«æ™‚é–“ãŒã‹ã‹ã‚‹ãƒ†ã‚¹ãƒˆ
        - `@pytest.mark.skip_ci`: CIç’°å¢ƒã§ã¯ã‚¹ã‚­ãƒƒãƒ—
        
        ### ãƒãƒ¼ã‚«ãƒ¼æŒ‡å®šå®Ÿè¡Œ
        ```bash
        # ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã®ã¿
        pytest -m unit
        
        # é…ã„ãƒ†ã‚¹ãƒˆã‚’é™¤å¤–
        pytest -m "not slow"
        
        # ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã‹ã¤é…ããªã„
        pytest -m "unit and not slow"
        ```
        
        ## åˆ©ç”¨å¯èƒ½ãªãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£
        
        conftest.py ã§å®šç¾©ã•ã‚ŒãŸå…±é€šãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£:
        
        ### ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ 
        - `temp_project_dir`: ä¸€æ™‚ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
        - `sample_md_file`: ã‚µãƒ³ãƒ—ãƒ«Markdownãƒ•ã‚¡ã‚¤ãƒ«
        - `sample_config`: ãƒ†ã‚¹ãƒˆç”¨è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
        - `sample_env_file`: ãƒ†ã‚¹ãƒˆç”¨.envãƒ•ã‚¡ã‚¤ãƒ«
        
        ### ãƒ¢ãƒƒã‚¯
        - `mock_notion_client`: Notion APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ¢ãƒƒã‚¯
        - `mock_env_vars`: ç’°å¢ƒå¤‰æ•°ãƒ¢ãƒƒã‚¯
        
        ### ãƒ‡ãƒ¼ã‚¿
        - `sample_notion_blocks`: Notionãƒ–ãƒ­ãƒƒã‚¯ã‚µãƒ³ãƒ—ãƒ«
        - `sample_page_response`: APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚µãƒ³ãƒ—ãƒ«
        - `sample_hash_cache`: ãƒãƒƒã‚·ãƒ¥ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚µãƒ³ãƒ—ãƒ«
        
        ## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
        
        ### ImportError
        ```python
        # ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«å…ˆé ­ã«ãƒ‘ã‚¹è¿½åŠ 
        import sys
        from pathlib import Path
        sys.path.insert(0, str(Path(__file__).parents[4] / 'dev'))
        ```
        
        ### ã‚«ãƒãƒ¬ãƒƒã‚¸ãŒä½ã„
        - ç•°å¸¸ç³»ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚’è¿½åŠ 
        - ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆã‚’è¿½åŠ 
        - `--cov-report=term-missing` ã§æœªã‚«ãƒãƒ¼ç®‡æ‰€ã‚’ç¢ºèª
        
        ### ãƒ†ã‚¹ãƒˆå®Ÿè¡ŒãŒé…ã„
        - ä¸¦åˆ—å®Ÿè¡Œã‚’è©¦ã™: `pytest -n auto`
        - `@pytest.mark.slow` ã§ãƒãƒ¼ã‚­ãƒ³ã‚°ã—ã¦é™¤å¤–
        
        ## CI/CDé€£æº
        
        GitHub Actionsç­‰ã§ã®å®Ÿè¡Œä¾‹:
        ```yaml
        - name: Run Unit Tests
          run: |
            pip install -r requirements.txt
            pytest tests/ -v -m unit \
              --cov=../dev \
              --cov-report=xml \
              --junitxml=junit.xml
        
        - name: Upload Coverage
          uses: codecov/codecov-action@v3
          with:
            files: ./coverage.xml
        ```
        
        ## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—
        1. `TODO` ã‚³ãƒ¡ãƒ³ãƒˆã‚’å®Ÿè£…ã‚³ãƒ¼ãƒ‰ã«åˆã‚ã›ã¦å®Œæˆã•ã›ã‚‹
        2. ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’ç¢ºèª
        3. ã‚«ãƒãƒ¬ãƒƒã‚¸80%æœªæº€ã®ç®‡æ‰€ã«è¿½åŠ ãƒ†ã‚¹ãƒˆã‚’ä½œæˆ
        4. çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆ11_QAå®Ÿè¡Œï¼‰ã¸é€²ã‚€
    
    - name: "generate_unit_test_plan_document"
      action: "create_markdown_file"
      path: "Flow/{{today}}/{{flow_dir}}/11-1_ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆä½œæˆ/unit_test_plan.md"
      content: |
        # ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆè¨ˆç”»æ›¸
        
        **ä½œæˆæ—¥**: {{today}}
        **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ**: {{project_name}}
        **ç›®æ¨™ã‚«ãƒãƒ¬ãƒƒã‚¸**: 80%ä»¥ä¸Š
        
        ## 1. ãƒ†ã‚¹ãƒˆæˆ¦ç•¥
        
        ### 1.1 åŸºæœ¬æ–¹é‡
        - **å˜ä½“ãƒ†ã‚¹ãƒˆ**: å„é–¢æ•°ãƒ»ã‚¯ãƒ©ã‚¹ã‚’ç‹¬ç«‹ã—ã¦ãƒ†ã‚¹ãƒˆ
        - **ãƒ¢ãƒƒã‚¯æ´»ç”¨**: å¤–éƒ¨ä¾å­˜ã‚’æ’é™¤ï¼ˆNotion APIã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ï¼‰
        - **é«˜é€Ÿå®Ÿè¡Œ**: å…¨ãƒ†ã‚¹ãƒˆ < 30ç§’ã‚’ç›®æ¨™
        - **è‡ªå‹•åŒ–**: CI/CDçµ±åˆã‚’å‰æ
        
        ### 1.2 ãƒ†ã‚¹ãƒˆç¯„å›²
        {{test_analysis.summary}}
        
        **å¯¾è±¡ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«**: {{test_analysis.total_modules}}å€‹
        **å¯¾è±¡é–¢æ•°**: {{test_analysis.total_functions}}å€‹
        **æ¨å®šãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹**: {{test_analysis.estimated_test_cases}}ä»¶
        
        ### 1.3 é™¤å¤–ç¯„å›²
        - UI/CLIéƒ¨åˆ†ï¼ˆçµ±åˆãƒ†ã‚¹ãƒˆã§æ¤œè¨¼ï¼‰
        - ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ©ã‚¤ãƒ–ãƒ©ãƒªè‡ªä½“ã®ãƒ†ã‚¹ãƒˆ
        - è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆYAML/JSONï¼‰ã®å¦¥å½“æ€§ï¼ˆãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆã§æ¤œè¨¼ï¼‰
        
        ## 2. ãƒ†ã‚¹ãƒˆã‚°ãƒ«ãƒ¼ãƒ—
        
        {{#each test_analysis.groups}}
        ### Group {{@index}}: {{name}}
        **å„ªå…ˆåº¦**: {{priority}}
        **èª¬æ˜**: {{description}}
        **ãƒ†ã‚¹ãƒˆæ•°**: {{test_count}}ä»¶
        **ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«**: `{{test_file}}`
        
        #### å¯¾è±¡é–¢æ•°
        {{#each functions}}
        - `{{name}}`: {{description}}
          - æ­£å¸¸ç³»: {{normal_cases}}ä»¶
          - ç•°å¸¸ç³»: {{error_cases}}ä»¶
          - ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹: {{edge_cases}}ä»¶
        {{/each}}
        
        {{/each}}
        
        ## 3. ãƒ¢ãƒƒã‚¯æˆ¦ç•¥
        
        ### 3.1 Notion API
        **æ–¹é‡**: `unittest.mock.MagicMock` ã§å…¨ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ãƒ¢ãƒƒã‚¯
        
        ```python
        @pytest.fixture
        def mock_notion_client():
            client = MagicMock()
            client.pages.create.return_value = {...}
            return client
        ```
        
        **å¯¾è±¡ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**:
        - `pages.create`
        - `pages.update`
        - `pages.retrieve`
        - `blocks.children.append`
        - `databases.query`
        
        ### 3.2 ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ 
        **æ–¹é‡**: `tempfile.TemporaryDirectory` ã§ä¸€æ™‚ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½¿ç”¨
        
        ```python
        @pytest.fixture
        def temp_project_dir():
            with tempfile.TemporaryDirectory() as tmpdir:
                yield Path(tmpdir)
        ```
        
        ### 3.3 ç’°å¢ƒå¤‰æ•°
        **æ–¹é‡**: `monkeypatch` ã§å‹•çš„è¨­å®š
        
        ```python
        def test_env_loading(monkeypatch):
            monkeypatch.setenv('NOTION_TOKEN', 'test_token')
        ```
        
        ## 4. ã‚«ãƒãƒ¬ãƒƒã‚¸ç›®æ¨™
        
        | ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« | ç›®æ¨™ã‚«ãƒãƒ¬ãƒƒã‚¸ | ç†ç”± |
        |-----------|---------------|------|
        | ç’°å¢ƒå¤‰æ•°èª­ã¿è¾¼ã¿ | 90%+ | ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ãƒ‘ã‚¹ |
        | Markdownå¤‰æ› | 85%+ | ã‚³ã‚¢æ©Ÿèƒ½ |
        | ãƒãƒƒã‚·ãƒ¥ã‚­ãƒ£ãƒƒã‚·ãƒ¥ | 85%+ | ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹é‡è¦ |
        | Push/Pull | 80%+ | çµ±åˆãƒ†ã‚¹ãƒˆã§è£œå®Œ |
        | ãã®ä»–ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ | 70%+ | ä½å„ªå…ˆåº¦ |
        
        **å…¨ä½“ç›®æ¨™**: 80%ä»¥ä¸Š
        
        ## 5. ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹è¨­è¨ˆ
        
        ### 5.1 æ­£å¸¸ç³»ãƒ†ã‚¹ãƒˆ
        - æ¨™æº–çš„ãªå…¥åŠ›ã§ã®å‹•ä½œç¢ºèª
        - æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›ã®æ¤œè¨¼
        - å‰¯ä½œç”¨ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆç­‰ï¼‰ã®ç¢ºèª
        
        ### 5.2 ç•°å¸¸ç³»ãƒ†ã‚¹ãƒˆ
        - ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ãªã„
        - APIã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹
        - ç’°å¢ƒå¤‰æ•°æœªè¨­å®š
        - ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
        
        ### 5.3 ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆ
        - ç©ºæ–‡å­—åˆ—
        - ç©ºãƒ•ã‚¡ã‚¤ãƒ«
        - å¤§ããªãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ1MB+ï¼‰
        - ç‰¹æ®Šæ–‡å­—ã‚’å«ã‚€å…¥åŠ›
        - å¢ƒç•Œå€¤ï¼ˆ0, -1, MAXç­‰ï¼‰
        
        ## 6. å®Ÿè¡Œè¨ˆç”»
        
        ### Phase 1: åŸºç›¤é–¢æ•°ï¼ˆå„ªå…ˆåº¦: é«˜ï¼‰
        - `test_env_loader.py`: ç’°å¢ƒå¤‰æ•°èª­ã¿è¾¼ã¿
        - å®Ÿè¡Œæ™‚é–“: ~5ç§’
        - ã‚«ãƒãƒ¬ãƒƒã‚¸æœŸå¾…: 90%+
        
        ### Phase 2: ã‚³ã‚¢æ©Ÿèƒ½ï¼ˆå„ªå…ˆåº¦: é«˜ï¼‰
        - `test_markdown_converter.py`: Markdownå¤‰æ›
        - å®Ÿè¡Œæ™‚é–“: ~10ç§’
        - ã‚«ãƒãƒ¬ãƒƒã‚¸æœŸå¾…: 85%+
        
        ### Phase 3: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ©Ÿèƒ½ï¼ˆå„ªå…ˆåº¦: ä¸­ï¼‰
        - `test_hash_cache.py`: ãƒãƒƒã‚·ãƒ¥ã‚­ãƒ£ãƒƒã‚·ãƒ¥
        - å®Ÿè¡Œæ™‚é–“: ~5ç§’
        - ã‚«ãƒãƒ¬ãƒƒã‚¸æœŸå¾…: 85%+
        
        ### Phase 4: ãã®ä»–ï¼ˆå„ªå…ˆåº¦: ä¸­ï¼‰
        - è¿½åŠ ã®ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°ãƒ†ã‚¹ãƒˆ
        - å®Ÿè¡Œæ™‚é–“: ~10ç§’
        - ã‚«ãƒãƒ¬ãƒƒã‚¸æœŸå¾…: 70%+
        
        **ç·å®Ÿè¡Œæ™‚é–“**: ~30ç§’
        
        ## 7. å“è³ªåŸºæº–
        
        ### åˆæ ¼åŸºæº–
        - [ ] å…¨ãƒ†ã‚¹ãƒˆãŒæˆåŠŸï¼ˆ0 failedï¼‰
        - [ ] ã‚«ãƒãƒ¬ãƒƒã‚¸80%ä»¥ä¸Š
        - [ ] å®Ÿè¡Œæ™‚é–“ < 60ç§’
        - [ ] è­¦å‘Šï¼ˆwarningsï¼‰ãŒ0ä»¶
        
        ### ãƒ¬ãƒ“ãƒ¥ãƒ¼è¦³ç‚¹
        - [ ] ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹åãŒã‚ã‹ã‚Šã‚„ã™ã„
        - [ ] ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ãŒé©åˆ‡
        - [ ] ãƒ¢ãƒƒã‚¯ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹
        - [ ] ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ãŒã‚«ãƒãƒ¼ã•ã‚Œã¦ã„ã‚‹
        
        ## 8. æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—
        1. ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã® `TODO` ã‚’å®Ÿè£…
        2. `./run_unit_tests.sh` ã§å®Ÿè¡Œ
        3. ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆã‚’ç¢ºèª
        4. ã‚«ãƒãƒ¬ãƒƒã‚¸ä¸è¶³ç®‡æ‰€ã«è¿½åŠ ãƒ†ã‚¹ãƒˆ
        5. çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆ11_QAå®Ÿè¡Œï¼‰ã¸é€²ã‚€
    
    - name: "notify_completion"
      action: "display"
      content: |
        âœ… ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆä½œæˆãŒå®Œäº†ã—ã¾ã—ãŸ
        
        **ç”Ÿæˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«**:
        â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
        ğŸ“„ è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«:
        - pytest.ini: pytestè¨­å®šï¼ˆã‚«ãƒãƒ¬ãƒƒã‚¸80%å¿…é ˆï¼‰
        - requirements.txt: Pythonä¾å­˜é–¢ä¿‚
        
        ğŸ“ ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰:
        - tests/conftest.py: å…±é€šãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£
        - tests/test_env_loader.py: ç’°å¢ƒå¤‰æ•°èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ
        - tests/test_markdown_converter.py: Markdownå¤‰æ›ãƒ†ã‚¹ãƒˆ
        - tests/test_hash_cache.py: ãƒãƒƒã‚·ãƒ¥ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ†ã‚¹ãƒˆ
        
        ğŸ”§ å®Ÿè¡Œã‚¹ã‚¯ãƒªãƒ—ãƒˆ:
        - run_unit_tests.sh: ãƒ¯ãƒ³ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œ
        
        ğŸ“– ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ:
        - README.md: å®Ÿè¡Œã‚¬ã‚¤ãƒ‰
        - unit_test_plan.md: ãƒ†ã‚¹ãƒˆè¨ˆç”»æ›¸
        
        **æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³**:
        â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
        1. å®Ÿè£…ã‚³ãƒ¼ãƒ‰ã«åˆã‚ã›ã¦ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã® `TODO` ã‚’å®Œæˆã•ã›ã‚‹
        2. ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ:
           ```bash
           cd 11-1_ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆä½œæˆ
           ./run_unit_tests.sh
           ```
        3. ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆã‚’ç¢ºèª:
           ```bash
           open coverage_reports/html/index.html
           ```
        4. ã‚«ãƒãƒ¬ãƒƒã‚¸80%æœªæº€ã®ç®‡æ‰€ã«è¿½åŠ ãƒ†ã‚¹ãƒˆã‚’ä½œæˆ
        5. å…¨ãƒ†ã‚¹ãƒˆæˆåŠŸå¾Œã€`11_QAå®Ÿè¡Œ` ã§çµ±åˆãƒ†ã‚¹ãƒˆã¸é€²ã‚€
        
        **é‡è¦**:
        - ç¾åœ¨ã®ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã«ã¯ `TODO` ã‚³ãƒ¡ãƒ³ãƒˆãŒå«ã¾ã‚Œã¦ã„ã¾ã™
        - å®Ÿéš›ã®å®Ÿè£…ã‚³ãƒ¼ãƒ‰ã«åˆã‚ã›ã¦ã€é–¢æ•°å‘¼ã³å‡ºã—ã¨ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ã—ã¦ãã ã•ã„
        - ãƒ¢ãƒƒã‚¯ãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£ï¼ˆconftest.pyï¼‰ã¯å®Ÿè£…ã«å¿œã˜ã¦ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ã¦ãã ã•ã„
```

## æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰
â†’ `11_QAå®Ÿè¡Œ` ã§çµ±åˆãƒ†ã‚¹ãƒˆãƒ»ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆã¸é€²ã‚€

## ç‰¹å¾´
- **pytest + coverageçµ±åˆ**: ã‚«ãƒãƒ¬ãƒƒã‚¸80%ã‚’å¼·åˆ¶ã™ã‚‹è¨­å®š
- **conftest.pyè‡ªå‹•ç”Ÿæˆ**: å†åˆ©ç”¨å¯èƒ½ãªãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£ã‚’æä¾›
- **ãƒ¢ãƒƒã‚¯æˆ¦ç•¥æ˜ç¢ºåŒ–**: Notion APIã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã€ç’°å¢ƒå¤‰æ•°ã®ãƒ¢ãƒƒã‚¯æ–¹é‡
- **å®Ÿè¡Œã‚¹ã‚¯ãƒªãƒ—ãƒˆ**: ãƒ¯ãƒ³ã‚³ãƒãƒ³ãƒ‰ã§ãƒ†ã‚¹ãƒˆå®Ÿè¡Œãƒ»ã‚«ãƒãƒ¬ãƒƒã‚¸ç¢ºèª
- **è©³ç´°ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: README.mdã¨unit_test_plan.mdã§é‹ç”¨ã‚¬ã‚¤ãƒ‰å®Œå‚™
- **TODOå½¢å¼**: å®Ÿè£…ã‚³ãƒ¼ãƒ‰ã«åˆã‚ã›ã¦ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯èƒ½ãªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
